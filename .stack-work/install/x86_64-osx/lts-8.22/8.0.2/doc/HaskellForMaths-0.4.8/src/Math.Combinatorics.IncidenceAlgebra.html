<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- Copyright (c) 2011-2015, David Amos. All rights reserved.</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances, NoMonomorphismRestriction #-}</span><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Math</span><span class="hs-operator">.</span><span class="hs-identifier">Combinatorics</span><span class="hs-operator">.</span><span class="hs-identifier">IncidenceAlgebra</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">*&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><a href="Math.Core.Utils.html"><span class="hs-identifier">Math</span><span class="hs-operator">.</span><span class="hs-identifier">Core</span><span class="hs-operator">.</span><span class="hs-identifier">Utils</span></a><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><a href="Math.Combinatorics.Digraph.html"><span class="hs-identifier">Math</span><span class="hs-operator">.</span><span class="hs-identifier">Combinatorics</span><span class="hs-operator">.</span><span class="hs-identifier">Digraph</span></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><a href="Math.Combinatorics.Poset.html"><span class="hs-identifier">Math</span><span class="hs-operator">.</span><span class="hs-identifier">Combinatorics</span><span class="hs-operator">.</span><span class="hs-identifier">Poset</span></a><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><a href="Math.Algebra.Field.Base.html"><span class="hs-identifier">Math</span><span class="hs-operator">.</span><span class="hs-identifier">Algebra</span><span class="hs-operator">.</span><span class="hs-identifier">Field</span><span class="hs-operator">.</span><span class="hs-identifier">Base</span></a><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><a href="Math.Algebras.VectorSpace.html"><span class="hs-identifier">Math</span><span class="hs-operator">.</span><span class="hs-identifier">Algebras</span><span class="hs-operator">.</span><span class="hs-identifier">VectorSpace</span></a><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><a href="Math.Algebras.TensorProduct.html"><span class="hs-identifier">Math</span><span class="hs-operator">.</span><span class="hs-identifier">Algebras</span><span class="hs-operator">.</span><span class="hs-identifier">TensorProduct</span></a><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="Math.Algebras.Structures.html"><span class="hs-identifier">Math</span><span class="hs-operator">.</span><span class="hs-identifier">Algebras</span><span class="hs-operator">.</span><span class="hs-identifier">Structures</span></a><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">L</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Set</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">S</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span class="hs-comment">-- INTERVALS IN A POSET</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-comment">-- |A type to represent an interval in a poset. The (closed) interval [x,y] is the set {z | x &lt;= z &lt;= y} within the poset.</span><span>
</span><a name="line-28"></a><span class="hs-comment">-- Note that the \&quot;empty interval\&quot; is not an interval - that is, the interval [x,y] is only defined for x &lt;= y.</span><span>
</span><a name="line-29"></a><span class="hs-comment">-- The (closed) intervals within a poset form a basis for the incidence algebra as a k-vector space.</span><span>
</span><a name="line-30"></a><span class="hs-keyword">data</span><span> </span><a name="Interval"><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier">Interval</span></a></a><span> </span><a name="local-6989586621679180913"><a href="#local-6989586621679180913"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Iv"><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier">Iv</span></a></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.Poset.html#Poset"><span class="hs-identifier hs-type">Poset</span></a><span> </span><a href="#local-6989586621679180913"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679180913"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679180913"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679181071"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-6989586621679181071"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-33"></a><span>    </span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679181072"><a href="#local-6989586621679181072"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621679181073"><a href="#local-6989586621679181073"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><a name="local-3458764513820541095"><span class="hs-operator">==</span></a><span> </span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679181074"><a href="#local-6989586621679181074"><span class="hs-identifier">a'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679181075"><a href="#local-6989586621679181075"><span class="hs-identifier">b'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181072"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679181073"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181074"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">,</span><a href="#local-6989586621679181075"><span class="hs-identifier hs-var">b'</span></a><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span class="hs-comment">-- we don't bother to check that they are from the same poset</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679181066"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-6989586621679181066"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-37"></a><span>    </span><a name="local-8214565720323790872"><span class="hs-identifier">compare</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679181067"><a href="#local-6989586621679181067"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621679181068"><a href="#local-6989586621679181068"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679181069"><a href="#local-6989586621679181069"><span class="hs-identifier">a'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679181070"><a href="#local-6989586621679181070"><span class="hs-identifier">b'</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">compare</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181067"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679181068"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181069"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">,</span><a href="#local-6989586621679181070"><span class="hs-identifier hs-var">b'</span></a><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679181063"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-6989586621679181063"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-40"></a><span>    </span><a name="local-8214565720323790731"><span class="hs-identifier">show</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679181064"><a href="#local-6989586621679181064"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621679181065"><a href="#local-6989586621679181065"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Iv (&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679181064"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;,&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679181065"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-comment">{-
-- !! This should probably be called heightPartition not rank
-- rank is only well-defined if we don't have cover edges jumping levels
rankPartition (Iv poset@(Poset (set,po)) (a,b)) = rankPartition' S.empty [a] (L.delete a iv)
    where rankPartition' _ level [] = [level]
          rankPartition' interior boundary exterior =
              let interior' = S.union interior (S.fromList boundary)
                  boundary' = toSet [v | (u,v) &lt;- es, u `elem` boundary, all (`S.member` interior') (predecessors es v)]
                  exterior' = exterior \\ boundary'
              in boundary : rankPartition' interior' boundary' exterior'
          iv = interval poset (a,b)
          (_,es) = coverGraph (Poset (iv,po))
          predecessors es v = [u | (u,v') &lt;- es, v' == v]
-- !! Can be written more efficiently, eg by memoising predecessors and successors, culling covers as we use them, etc.

-- The point of rankPartition function is to enable a slightly faster isomorphism test
-- Could do even better by refining with (indegree, outdegree)
-}</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-comment">-- The sub-poset defined by an interval</span><span>
</span><a name="line-62"></a><a name="ivPoset"><a href="Math.Combinatorics.IncidenceAlgebra.html#ivPoset"><span class="hs-identifier">ivPoset</span></a></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a name="local-6989586621679180931"><a href="#local-6989586621679180931"><span class="hs-identifier">poset</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Math.Combinatorics.Poset.html#Poset"><span class="hs-identifier hs-var">Poset</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679180932"><a href="#local-6989586621679180932"><span class="hs-identifier">po</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679180933"><a href="#local-6989586621679180933"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679180934"><a href="#local-6989586621679180934"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Combinatorics.Poset.html#Poset"><span class="hs-identifier hs-var">Poset</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.Poset.html#interval"><span class="hs-identifier hs-var">interval</span></a><span> </span><a href="#local-6989586621679180931"><span class="hs-identifier hs-var">poset</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679180933"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679180934"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679180932"><span class="hs-identifier hs-var">po</span></a><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><a name="intervalIsos"><a href="Math.Combinatorics.IncidenceAlgebra.html#intervalIsos"><span class="hs-identifier">intervalIsos</span></a></a><span> </span><a name="local-6989586621679180935"><a href="#local-6989586621679180935"><span class="hs-identifier">iv1</span></a></a><span> </span><a name="local-6989586621679180936"><a href="#local-6989586621679180936"><span class="hs-identifier">iv2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Combinatorics.Poset.html#orderIsos"><span class="hs-identifier hs-var">orderIsos</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#ivPoset"><span class="hs-identifier hs-var">ivPoset</span></a><span> </span><a href="#local-6989586621679180935"><span class="hs-identifier hs-var">iv1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#ivPoset"><span class="hs-identifier hs-var">ivPoset</span></a><span> </span><a href="#local-6989586621679180936"><span class="hs-identifier hs-var">iv2</span></a><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><a name="isIntervalIso"><a href="Math.Combinatorics.IncidenceAlgebra.html#isIntervalIso"><span class="hs-identifier">isIntervalIso</span></a></a><span> </span><a name="local-6989586621679180937"><a href="#local-6989586621679180937"><span class="hs-identifier">iv1</span></a></a><span> </span><a name="local-6989586621679180938"><a href="#local-6989586621679180938"><span class="hs-identifier">iv2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Combinatorics.Poset.html#isOrderIso"><span class="hs-identifier hs-var">isOrderIso</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#ivPoset"><span class="hs-identifier hs-var">ivPoset</span></a><span> </span><a href="#local-6989586621679180937"><span class="hs-identifier hs-var">iv1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#ivPoset"><span class="hs-identifier hs-var">ivPoset</span></a><span> </span><a href="#local-6989586621679180938"><span class="hs-identifier hs-var">iv2</span></a><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span class="hs-comment">-- we're only really interested in comparing intervals in the same poset</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-comment">{-
intervalIsoMap1 poset = intervalIsoMap' M.empty [Iv poset xy | xy &lt;- L.sort (intervals poset)]
    where intervalIsoMap' m (iv:ivs) =
              let reps = [iv' | iv' &lt;- M.keys m, m M.! iv' == Nothing, iv `isIntervalIso` iv']
              in if null reps
                 then intervalIsoMap' (M.insert iv Nothing m) ivs
                 else let [iv'] = reps in intervalIsoMap' (M.insert iv (Just iv') m) ivs
          intervalIsoMap' m [] = m
-}</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-comment">-- A poset on n vertices has at most n(n+1)/2 intervals</span><span>
</span><a name="line-80"></a><span class="hs-comment">-- In the worst case, we might have to compare each interval to all earlier intervals</span><span>
</span><a name="line-81"></a><span class="hs-comment">-- Hence this is O(n^4)</span><span>
</span><a name="line-82"></a><a name="intervalIsoMap"><a href="Math.Combinatorics.IncidenceAlgebra.html#intervalIsoMap"><span class="hs-identifier">intervalIsoMap</span></a></a><span> </span><a name="local-6989586621679180939"><a href="#local-6989586621679180939"><span class="hs-identifier">poset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679180941"><span class="hs-identifier hs-var">isoMap</span></a><span>
</span><a name="line-83"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679180940"><a href="#local-6989586621679180940"><span class="hs-identifier">ivs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a href="#local-6989586621679180939"><span class="hs-identifier hs-var">poset</span></a><span> </span><a href="#local-6989586621679180943"><span class="hs-identifier hs-var">xy</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679180943"><a href="#local-6989586621679180943"><span class="hs-identifier">xy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Math.Combinatorics.Poset.html#intervals"><span class="hs-identifier hs-var">intervals</span></a><span> </span><a href="#local-6989586621679180939"><span class="hs-identifier hs-var">poset</span></a><span class="hs-special">]</span><span>
</span><a name="line-84"></a><span>          </span><a name="local-6989586621679180941"><a href="#local-6989586621679180941"><span class="hs-identifier">isoMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679180944"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679180942"><span class="hs-identifier hs-var">isoMap'</span></a><span> </span><a href="#local-6989586621679180944"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679180944"><a href="#local-6989586621679180944"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679180940"><span class="hs-identifier hs-var">ivs</span></a><span class="hs-special">]</span><span>
</span><a name="line-85"></a><span>          </span><a name="local-6989586621679180942"><a href="#local-6989586621679180942"><span class="hs-identifier">isoMap'</span></a></a><span> </span><a name="local-6989586621679180945"><a href="#local-6989586621679180945"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679180946"><a href="#local-6989586621679180946"><span class="hs-identifier">reps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679180947"><span class="hs-identifier hs-var">iv'</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679180947"><a href="#local-6989586621679180947"><span class="hs-identifier">iv'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679180940"><span class="hs-identifier hs-var">ivs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679180947"><span class="hs-identifier hs-var">iv'</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679180945"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679180941"><span class="hs-identifier hs-var">isoMap</span></a><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.!</span><span> </span><a href="#local-6989586621679180947"><span class="hs-identifier hs-var">iv'</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679180945"><span class="hs-identifier hs-var">iv</span></a><span> </span><span class="hs-special">`</span><a href="Math.Combinatorics.IncidenceAlgebra.html#isIntervalIso"><span class="hs-identifier hs-var">isIntervalIso</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679180947"><span class="hs-identifier hs-var">iv'</span></a><span class="hs-special">]</span><span>
</span><a name="line-86"></a><span>                       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679180946"><span class="hs-identifier hs-var">reps</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679180948"><a href="#local-6989586621679180948"><span class="hs-identifier">rep</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679180946"><span class="hs-identifier hs-var">reps</span></a><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679180948"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-87"></a><span class="hs-comment">-- Once an interval is identified as a representative, it is likely to take part in many isomorphism tests</span><span>
</span><a name="line-88"></a><span class="hs-comment">-- Whereas most intervals take part in only one</span><span>
</span><a name="line-89"></a><span class="hs-comment">-- So perhaps we could make this more efficient by having an isomorphism test which uses a height partition</span><span>
</span><a name="line-90"></a><span class="hs-comment">-- for the LHS but not for the RHS?</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-comment">-- |List representatives of the order isomorphism classes of intervals in a poset</span><span>
</span><a name="line-93"></a><span class="hs-identifier">intervalIsoClasses</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679180930"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Math.Combinatorics.Poset.html#Poset"><span class="hs-identifier hs-type">Poset</span></a><span> </span><a href="#local-6989586621679180930"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-6989586621679180930"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-94"></a><a name="intervalIsoClasses"><a href="Math.Combinatorics.IncidenceAlgebra.html#intervalIsoClasses"><span class="hs-identifier">intervalIsoClasses</span></a></a><span> </span><a name="local-6989586621679180949"><a href="#local-6989586621679180949"><span class="hs-identifier">poset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679180951"><span class="hs-identifier hs-var">iv</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679180951"><a href="#local-6989586621679180951"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">keys</span><span> </span><a href="#local-6989586621679180950"><span class="hs-identifier hs-var">isoMap</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679180950"><span class="hs-identifier hs-var">isoMap</span></a><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.!</span><span> </span><a href="#local-6989586621679180951"><span class="hs-identifier hs-var">iv</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">]</span><span>
</span><a name="line-95"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679180950"><a href="#local-6989586621679180950"><span class="hs-identifier">isoMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Combinatorics.IncidenceAlgebra.html#intervalIsoMap"><span class="hs-identifier hs-var">intervalIsoMap</span></a><span> </span><a href="#local-6989586621679180949"><span class="hs-identifier hs-var">poset</span></a><span> </span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-comment">-- INCIDENCE ALGEBRA</span><span>
</span><a name="line-99"></a><span>
</span><a name="line-100"></a><span class="hs-comment">-- |The incidence algebra of a poset is the free k-vector space having as its basis the set of intervals in the poset,</span><span>
</span><a name="line-101"></a><span class="hs-comment">-- with multiplication defined by concatenation of intervals.</span><span>
</span><a name="line-102"></a><span class="hs-comment">-- The incidence algebra can also be thought of as the vector space of functions from intervals to k, with multiplication</span><span>
</span><a name="line-103"></a><span class="hs-comment">-- defined by the convolution (f*g)(x,y) = sum [ f(x,z) g(z,y) | x &lt;= z &lt;= y ].</span><span>
</span><a name="line-104"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679181055"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679181055"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679181056"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Math.Algebras.Structures.html#Algebra"><span class="hs-identifier hs-type">Algebra</span></a><span> </span><a href="#local-6989586621679181055"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-6989586621679181056"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-105"></a><span>    </span><span class="hs-comment">-- |Note that we are not able to give a generic definition of unit for the incidence algebra,</span><span>
</span><a name="line-106"></a><span>    </span><span class="hs-comment">-- because it depends on which poset we are working in,</span><span>
</span><a name="line-107"></a><span>    </span><span class="hs-comment">-- and that information is encoded at the value level rather than the type level. See unitIA.</span><span>
</span><a name="line-108"></a><span>    </span><a name="local-8214565720323845983"><a href="Math.Algebras.Structures.html#unit"><span class="hs-identifier">unit</span></a></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebras.VectorSpace.html#zerov"><span class="hs-identifier hs-var">zerov</span></a><span> </span><span class="hs-comment">-- so that sum works</span><span>
</span><a name="line-109"></a><span>    </span><span class="hs-comment">-- unit x = x *&gt; sumv [return (Iv (a,a)) | a &lt;- poset] -- the delta function</span><span>
</span><a name="line-110"></a><span>    </span><span class="hs-comment">-- but we can't know from the types alone which poset we are working in</span><span>
</span><a name="line-111"></a><span>    </span><a name="local-8214565720323845984"><a href="Math.Algebras.Structures.html#mult"><span class="hs-identifier">mult</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebras.VectorSpace.html#linear"><span class="hs-identifier hs-var">linear</span></a><span> </span><a href="#local-6989586621679181057"><span class="hs-identifier hs-var">mult'</span></a><span>
</span><a name="line-112"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679181057"><a href="#local-6989586621679181057"><span class="hs-identifier">mult'</span></a></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a name="local-6989586621679181058"><a href="#local-6989586621679181058"><span class="hs-identifier">poset</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679181059"><a href="#local-6989586621679181059"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621679181060"><a href="#local-6989586621679181060"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679181061"><a href="#local-6989586621679181061"><span class="hs-identifier">c</span></a></a><span class="hs-special">,</span><a name="local-6989586621679181062"><a href="#local-6989586621679181062"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679181060"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679181061"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a href="#local-6989586621679181058"><span class="hs-identifier hs-var">poset</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181059"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679181062"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="Math.Algebras.VectorSpace.html#zerov"><span class="hs-identifier hs-var">zerov</span></a><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-comment">-- So multiplication in the incidence algebra is about composition of intervals</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span class="hs-comment">-- |The unit of the incidence algebra of a poset</span><span>
</span><a name="line-118"></a><span class="hs-identifier">unitIA</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679180928"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679180928"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679180929"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Math.Combinatorics.Poset.html#Poset"><span class="hs-identifier hs-type">Poset</span></a><span> </span><a href="#local-6989586621679180929"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.Algebras.VectorSpace.html#Vect"><span class="hs-identifier hs-type">Vect</span></a><span> </span><a href="#local-6989586621679180928"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-6989586621679180929"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-119"></a><a name="unitIA"><a href="Math.Combinatorics.IncidenceAlgebra.html#unitIA"><span class="hs-identifier">unitIA</span></a></a><span> </span><a name="local-6989586621679180952"><a href="#local-6989586621679180952"><span class="hs-identifier">poset</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Math.Combinatorics.Poset.html#Poset"><span class="hs-identifier hs-var">Poset</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679180953"><a href="#local-6989586621679180953"><span class="hs-identifier">set</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebras.VectorSpace.html#sumv"><span class="hs-identifier hs-var">sumv</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a href="#local-6989586621679180952"><span class="hs-identifier hs-var">poset</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679180954"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679180954"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679180954"><a href="#local-6989586621679180954"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679180953"><span class="hs-identifier hs-var">set</span></a><span class="hs-special">]</span><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-identifier">basisIA</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679180926"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Math.Combinatorics.Poset.html#Poset"><span class="hs-identifier hs-type">Poset</span></a><span> </span><a href="#local-6989586621679180927"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Math.Algebras.VectorSpace.html#Vect"><span class="hs-identifier hs-type">Vect</span></a><span> </span><a href="#local-6989586621679180926"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-6989586621679180927"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-122"></a><a name="basisIA"><a href="Math.Combinatorics.IncidenceAlgebra.html#basisIA"><span class="hs-identifier">basisIA</span></a></a><span> </span><a name="local-6989586621679180955"><a href="#local-6989586621679180955"><span class="hs-identifier">poset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a href="#local-6989586621679180955"><span class="hs-identifier hs-var">poset</span></a><span> </span><a href="#local-6989586621679180956"><span class="hs-identifier hs-var">xy</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679180956"><a href="#local-6989586621679180956"><span class="hs-identifier">xy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Math.Combinatorics.Poset.html#intervals"><span class="hs-identifier hs-var">intervals</span></a><span> </span><a href="#local-6989586621679180955"><span class="hs-identifier hs-var">poset</span></a><span class="hs-special">]</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-comment">-- |The zeta function of a poset</span><span>
</span><a name="line-125"></a><span class="hs-identifier">zetaIA</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679180924"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679180924"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679180925"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Math.Combinatorics.Poset.html#Poset"><span class="hs-identifier hs-type">Poset</span></a><span> </span><a href="#local-6989586621679180925"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.Algebras.VectorSpace.html#Vect"><span class="hs-identifier hs-type">Vect</span></a><span> </span><a href="#local-6989586621679180924"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-6989586621679180925"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-126"></a><a name="zetaIA"><a href="Math.Combinatorics.IncidenceAlgebra.html#zetaIA"><span class="hs-identifier">zetaIA</span></a></a><span> </span><a name="local-6989586621679180957"><a href="#local-6989586621679180957"><span class="hs-identifier">poset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebras.VectorSpace.html#sumv"><span class="hs-identifier hs-var">sumv</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Math.Combinatorics.IncidenceAlgebra.html#basisIA"><span class="hs-identifier hs-var">basisIA</span></a><span> </span><a href="#local-6989586621679180957"><span class="hs-identifier hs-var">poset</span></a><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span class="hs-comment">-- Then for example, zeta^2 counts the number of points in each interval</span><span>
</span><a name="line-129"></a><span class="hs-comment">-- See Stanley, Enumerative Combinatorics I, p115ff, for more similar</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-comment">-- calculate the mobius function of a poset: naive implementation</span><span>
</span><a name="line-132"></a><a name="muIA1"><a href="Math.Combinatorics.IncidenceAlgebra.html#muIA1"><span class="hs-identifier">muIA1</span></a></a><span> </span><a name="local-6989586621679180958"><a href="#local-6989586621679180958"><span class="hs-identifier">poset</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Math.Combinatorics.Poset.html#Poset"><span class="hs-identifier hs-var">Poset</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679180959"><a href="#local-6989586621679180959"><span class="hs-identifier">set</span></a></a><span class="hs-special">,</span><a name="local-6989586621679180960"><a href="#local-6989586621679180960"><span class="hs-identifier">po</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679180961"><span class="hs-identifier hs-var">mu</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679180965"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679180966"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="Math.Algebras.VectorSpace.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a href="#local-6989586621679180958"><span class="hs-identifier hs-var">poset</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679180965"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679180966"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679180965"><a href="#local-6989586621679180965"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679180959"><span class="hs-identifier hs-var">set</span></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679180966"><a href="#local-6989586621679180966"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679180959"><span class="hs-identifier hs-var">set</span></a><span class="hs-special">]</span><span>
</span><a name="line-133"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679180961"><a href="#local-6989586621679180961"><span class="hs-identifier">mu</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679180962"><a href="#local-6989586621679180962"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679180963"><a href="#local-6989586621679180963"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679180962"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679180963"><span class="hs-identifier hs-var">y</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-134"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679180960"><span class="hs-identifier hs-var">po</span></a><span> </span><a href="#local-6989586621679180962"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679180963"><span class="hs-identifier hs-var">y</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">negate</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679180961"><span class="hs-identifier hs-var">mu</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679180962"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679180964"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679180964"><a href="#local-6989586621679180964"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679180959"><span class="hs-identifier hs-var">set</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679180960"><span class="hs-identifier hs-var">po</span></a><span> </span><a href="#local-6989586621679180962"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679180964"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679180960"><span class="hs-identifier hs-var">po</span></a><span> </span><a href="#local-6989586621679180964"><span class="hs-identifier hs-var">z</span></a><span> </span><a href="#local-6989586621679180963"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679180964"><span class="hs-identifier hs-var">z</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679180963"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">]</span><span>
</span><a name="line-135"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-comment">-- calculate the mobius function of a poset, with memoization</span><span>
</span><a name="line-138"></a><span class="hs-comment">-- |The Mobius function of a poset</span><span>
</span><a name="line-139"></a><span class="hs-identifier">muIA</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679180922"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679180922"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679180923"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Math.Combinatorics.Poset.html#Poset"><span class="hs-identifier hs-type">Poset</span></a><span> </span><a href="#local-6989586621679180923"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.Algebras.VectorSpace.html#Vect"><span class="hs-identifier hs-type">Vect</span></a><span> </span><a href="#local-6989586621679180922"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-6989586621679180923"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-140"></a><a name="muIA"><a href="Math.Combinatorics.IncidenceAlgebra.html#muIA"><span class="hs-identifier">muIA</span></a></a><span> </span><a name="local-6989586621679180967"><a href="#local-6989586621679180967"><span class="hs-identifier">poset</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Math.Combinatorics.Poset.html#Poset"><span class="hs-identifier hs-var">Poset</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679180968"><a href="#local-6989586621679180968"><span class="hs-identifier">set</span></a></a><span class="hs-special">,</span><a name="local-6989586621679180969"><a href="#local-6989586621679180969"><span class="hs-identifier">po</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebras.VectorSpace.html#sumv"><span class="hs-identifier hs-var">sumv</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679180971"><span class="hs-identifier hs-var">mus</span></a><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679180977"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679180978"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="Math.Algebras.VectorSpace.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a href="#local-6989586621679180967"><span class="hs-identifier hs-var">poset</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679180977"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679180978"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679180977"><a href="#local-6989586621679180977"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679180968"><span class="hs-identifier hs-var">set</span></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679180978"><a href="#local-6989586621679180978"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679180968"><span class="hs-identifier hs-var">set</span></a><span class="hs-special">]</span><span>
</span><a name="line-141"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679180970"><a href="#local-6989586621679180970"><span class="hs-identifier">mu</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679180972"><a href="#local-6989586621679180972"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679180973"><a href="#local-6989586621679180973"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679180972"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679180973"><span class="hs-identifier hs-var">y</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-142"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679180969"><span class="hs-identifier hs-var">po</span></a><span> </span><a href="#local-6989586621679180972"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679180973"><span class="hs-identifier hs-var">y</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">negate</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679180971"><span class="hs-identifier hs-var">mus</span></a><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679180972"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679180974"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679180974"><a href="#local-6989586621679180974"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679180968"><span class="hs-identifier hs-var">set</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679180969"><span class="hs-identifier hs-var">po</span></a><span> </span><a href="#local-6989586621679180972"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679180974"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679180969"><span class="hs-identifier hs-var">po</span></a><span> </span><a href="#local-6989586621679180974"><span class="hs-identifier hs-var">z</span></a><span> </span><a href="#local-6989586621679180973"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679180974"><span class="hs-identifier hs-var">z</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679180973"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">]</span><span>
</span><a name="line-143"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-144"></a><span>          </span><a name="local-6989586621679180971"><a href="#local-6989586621679180971"><span class="hs-identifier">mus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679180975"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679180976"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679180970"><span class="hs-identifier hs-var">mu</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679180975"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679180976"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679180975"><a href="#local-6989586621679180975"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679180968"><span class="hs-identifier hs-var">set</span></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679180976"><a href="#local-6989586621679180976"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679180968"><span class="hs-identifier hs-var">set</span></a><span class="hs-special">]</span><span> </span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span class="hs-comment">-- calculate the inverse of a function in the incidence algebra: naive implementation</span><span>
</span><a name="line-147"></a><a name="invIA1"><a href="Math.Combinatorics.IncidenceAlgebra.html#invIA1"><span class="hs-identifier">invIA1</span></a></a><span> </span><a name="local-6989586621679180979"><a href="#local-6989586621679180979"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679180979"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Math.Algebras.VectorSpace.html#zerov"><span class="hs-identifier hs-var">zerov</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;invIA 0&quot;</span><span>
</span><a name="line-148"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679180983"><span class="hs-identifier hs-var">f'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679180992"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679180992"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679180992"><a href="#local-6989586621679180992"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679180981"><span class="hs-identifier hs-var">set</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;invIA: not invertible&quot;</span><span>
</span><a name="line-149"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679180984"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-150"></a><span>    </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a name="local-6989586621679180980"><a href="#local-6989586621679180980"><span class="hs-identifier">poset</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Math.Combinatorics.Poset.html#Poset"><span class="hs-identifier hs-var">Poset</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679180981"><a href="#local-6989586621679180981"><span class="hs-identifier">set</span></a></a><span class="hs-special">,</span><a name="local-6989586621679180982"><a href="#local-6989586621679180982"><span class="hs-identifier">po</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Math.Algebras.VectorSpace.html#terms"><span class="hs-identifier hs-var">terms</span></a><span> </span><a href="#local-6989586621679180979"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-151"></a><span>          </span><a name="local-6989586621679180983"><a href="#local-6989586621679180983"><span class="hs-identifier">f'</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679180986"><a href="#local-6989586621679180986"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679180987"><a href="#local-6989586621679180987"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebras.VectorSpace.html#coeff"><span class="hs-identifier hs-var">coeff</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a href="#local-6989586621679180980"><span class="hs-identifier hs-var">poset</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679180986"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679180987"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679180979"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-152"></a><span>          </span><a name="local-6989586621679180984"><a href="#local-6989586621679180984"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebras.VectorSpace.html#sumv"><span class="hs-identifier hs-var">sumv</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679180985"><span class="hs-identifier hs-var">g'</span></a><span> </span><a href="#local-6989586621679180988"><span class="hs-identifier hs-var">xy</span></a><span> </span><a href="Math.Algebras.VectorSpace.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a href="#local-6989586621679180980"><span class="hs-identifier hs-var">poset</span></a><span> </span><a href="#local-6989586621679180988"><span class="hs-identifier hs-var">xy</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679180988"><a href="#local-6989586621679180988"><span class="hs-identifier">xy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Math.Combinatorics.Poset.html#intervals"><span class="hs-identifier hs-var">intervals</span></a><span> </span><a href="#local-6989586621679180980"><span class="hs-identifier hs-var">poset</span></a><span class="hs-special">]</span><span>
</span><a name="line-153"></a><span>          </span><a name="local-6989586621679180985"><a href="#local-6989586621679180985"><span class="hs-identifier">g'</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679180989"><a href="#local-6989586621679180989"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679180990"><a href="#local-6989586621679180990"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679180989"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679180990"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">/</span><span> </span><a href="#local-6989586621679180983"><span class="hs-identifier hs-var">f'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679180989"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679180989"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-154"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">/</span><span> </span><a href="#local-6989586621679180983"><span class="hs-identifier hs-var">f'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679180989"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679180989"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679180983"><span class="hs-identifier hs-var">f'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679180989"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679180991"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679180985"><span class="hs-identifier hs-var">g'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679180991"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><a href="#local-6989586621679180990"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679180991"><a href="#local-6989586621679180991"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Math.Combinatorics.Poset.html#interval"><span class="hs-identifier hs-var">interval</span></a><span> </span><a href="#local-6989586621679180980"><span class="hs-identifier hs-var">poset</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679180989"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679180990"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679180989"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679180991"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">]</span><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span class="hs-comment">-- Stanley, Enumerative Combinatorics I, p144</span><span>
</span><a name="line-157"></a><span class="hs-comment">-- |The inverse of an element in the incidence algebra of a poset.</span><span>
</span><a name="line-158"></a><span class="hs-comment">-- This is only defined for elements which are non-zero on all intervals (x,x)</span><span>
</span><a name="line-159"></a><span class="hs-identifier">invIA</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679180920"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Fractional</span><span> </span><a href="#local-6989586621679180920"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679180921"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Math.Algebras.VectorSpace.html#Vect"><span class="hs-identifier hs-type">Vect</span></a><span> </span><a href="#local-6989586621679180920"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-6989586621679180921"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Math.Algebras.VectorSpace.html#Vect"><span class="hs-identifier hs-type">Vect</span></a><span> </span><a href="#local-6989586621679180920"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-6989586621679180921"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-160"></a><a name="invIA"><a href="Math.Combinatorics.IncidenceAlgebra.html#invIA"><span class="hs-identifier">invIA</span></a></a><span> </span><a name="local-6989586621679180993"><a href="#local-6989586621679180993"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679180993"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Math.Algebras.VectorSpace.html#zerov"><span class="hs-identifier hs-var">zerov</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-comment">-- error &quot;invIA 0&quot;</span><span>
</span><a name="line-161"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679180997"><span class="hs-identifier hs-var">f'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181008"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679181008"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679181008"><a href="#local-6989586621679181008"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679180995"><span class="hs-identifier hs-var">set</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-comment">-- error &quot;invIA: not invertible&quot;</span><span>
</span><a name="line-162"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679180998"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-163"></a><span>    </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a name="local-6989586621679180994"><a href="#local-6989586621679180994"><span class="hs-identifier">poset</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Math.Combinatorics.Poset.html#Poset"><span class="hs-identifier hs-var">Poset</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679180995"><a href="#local-6989586621679180995"><span class="hs-identifier">set</span></a></a><span class="hs-special">,</span><a name="local-6989586621679180996"><a href="#local-6989586621679180996"><span class="hs-identifier">po</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Math.Algebras.VectorSpace.html#terms"><span class="hs-identifier hs-var">terms</span></a><span> </span><a href="#local-6989586621679180993"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-164"></a><span>          </span><a name="local-6989586621679180997"><a href="#local-6989586621679180997"><span class="hs-identifier">f'</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679181001"><a href="#local-6989586621679181001"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679181002"><a href="#local-6989586621679181002"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebras.VectorSpace.html#coeff"><span class="hs-identifier hs-var">coeff</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a href="#local-6989586621679180994"><span class="hs-identifier hs-var">poset</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181001"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679181002"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679180993"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-165"></a><span>          </span><a name="local-6989586621679180998"><a href="#local-6989586621679180998"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebras.VectorSpace.html#sumv"><span class="hs-identifier hs-var">sumv</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679180999"><span class="hs-identifier hs-var">g'</span></a><span> </span><a href="#local-6989586621679181003"><span class="hs-identifier hs-var">xy</span></a><span> </span><a href="Math.Algebras.VectorSpace.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a href="#local-6989586621679180994"><span class="hs-identifier hs-var">poset</span></a><span> </span><a href="#local-6989586621679181003"><span class="hs-identifier hs-var">xy</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679181003"><a href="#local-6989586621679181003"><span class="hs-identifier">xy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Math.Combinatorics.Poset.html#intervals"><span class="hs-identifier hs-var">intervals</span></a><span> </span><a href="#local-6989586621679180994"><span class="hs-identifier hs-var">poset</span></a><span class="hs-special">]</span><span>
</span><a name="line-166"></a><span>          </span><a name="local-6989586621679180999"><a href="#local-6989586621679180999"><span class="hs-identifier">g'</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679181004"><a href="#local-6989586621679181004"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679181005"><a href="#local-6989586621679181005"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679181004"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679181005"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">/</span><span> </span><a href="#local-6989586621679180997"><span class="hs-identifier hs-var">f'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181004"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679181004"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-167"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">/</span><span> </span><a href="#local-6989586621679180997"><span class="hs-identifier hs-var">f'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181004"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679181004"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679180997"><span class="hs-identifier hs-var">f'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181004"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679181006"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181000"><span class="hs-identifier hs-var">g's</span></a><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181006"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><a href="#local-6989586621679181005"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679181006"><a href="#local-6989586621679181006"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Math.Combinatorics.Poset.html#interval"><span class="hs-identifier hs-var">interval</span></a><span> </span><a href="#local-6989586621679180994"><span class="hs-identifier hs-var">poset</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181004"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679181005"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679181004"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679181006"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">]</span><span>
</span><a name="line-168"></a><span>          </span><a name="local-6989586621679181000"><a href="#local-6989586621679181000"><span class="hs-identifier">g's</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679181007"><span class="hs-identifier hs-var">xy</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679180999"><span class="hs-identifier hs-var">g'</span></a><span> </span><a href="#local-6989586621679181007"><span class="hs-identifier hs-var">xy</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679181007"><a href="#local-6989586621679181007"><span class="hs-identifier">xy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Math.Combinatorics.Poset.html#intervals"><span class="hs-identifier hs-var">intervals</span></a><span> </span><a href="#local-6989586621679180994"><span class="hs-identifier hs-var">poset</span></a><span class="hs-special">]</span><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679181051"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Fractional</span><span> </span><a href="#local-6989586621679181051"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679181052"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679181052"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Math.Core.Utils.html#HasInverses"><span class="hs-identifier hs-type">HasInverses</span></a><span> </span><span class="hs-special">(</span><a href="Math.Algebras.VectorSpace.html#Vect"><span class="hs-identifier hs-type">Vect</span></a><span> </span><a href="#local-6989586621679181051"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-6989586621679181052"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-171"></a><span>    </span><a name="local-8214565720323815825"><a href="Math.Core.Utils.html#inverse"><span class="hs-identifier">inverse</span></a></a><span> </span><a name="local-6989586621679181053"><a href="#local-6989586621679181053"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Math.Combinatorics.IncidenceAlgebra.html#invIA"><span class="hs-identifier hs-var">invIA</span></a><span> </span><a href="#local-6989586621679181053"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-172"></a><span>                </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679181054"><a href="#local-6989586621679181054"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679181054"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-173"></a><span>                </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;IncidenceAlgebra.inverse: not invertible&quot;</span><span>
</span><a name="line-174"></a><span>
</span><a name="line-175"></a><span class="hs-comment">-- Then for example we can count multichains or chains using the incidence algebra - see Stanley</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-comment">-- |A function (ie element of the incidence algebra) that counts the total number of chains in each interval</span><span>
</span><a name="line-178"></a><span class="hs-identifier">numChainsIA</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679180919"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679180919"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Math.Combinatorics.Poset.html#Poset"><span class="hs-identifier hs-type">Poset</span></a><span> </span><a href="#local-6989586621679180919"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.Algebras.VectorSpace.html#Vect"><span class="hs-identifier hs-type">Vect</span></a><span> </span><a href="Math.Algebra.Field.Base.html#Q"><span class="hs-identifier hs-type">Q</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-6989586621679180919"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-179"></a><a name="numChainsIA"><a href="Math.Combinatorics.IncidenceAlgebra.html#numChainsIA"><span class="hs-identifier">numChainsIA</span></a></a><span> </span><a name="local-6989586621679181009"><a href="#local-6989586621679181009"><span class="hs-identifier">poset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span> </span><a href="Math.Algebras.VectorSpace.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a><span> </span><a href="Math.Combinatorics.IncidenceAlgebra.html#unitIA"><span class="hs-identifier hs-var">unitIA</span></a><span> </span><a href="#local-6989586621679181009"><span class="hs-identifier hs-var">poset</span></a><span> </span><a href="Math.Algebras.VectorSpace.html#%3C-%3E"><span class="hs-operator hs-var">&lt;-&gt;</span></a><span> </span><a href="Math.Combinatorics.IncidenceAlgebra.html#zetaIA"><span class="hs-identifier hs-var">zetaIA</span></a><span> </span><a href="#local-6989586621679181009"><span class="hs-identifier hs-var">poset</span></a><span class="hs-special">)</span><a href="Math.Core.Utils.html#%5E-"><span class="hs-operator hs-var">^-</span></a><span class="hs-number">1</span><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span class="hs-comment">-- The eta function on intervals (x,y) is 1 if x -&lt; y (y covers x), 0 otherwise</span><span>
</span><a name="line-182"></a><a name="etaIA"><a href="Math.Combinatorics.IncidenceAlgebra.html#etaIA"><span class="hs-identifier">etaIA</span></a></a><span> </span><a name="local-6989586621679181010"><a href="#local-6989586621679181010"><span class="hs-identifier">poset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a href="Math.Combinatorics.Digraph.html#DG"><span class="hs-identifier hs-var">DG</span></a><span> </span><a name="local-6989586621679181011"><a href="#local-6989586621679181011"><span class="hs-identifier">vs</span></a></a><span> </span><a name="local-6989586621679181012"><a href="#local-6989586621679181012"><span class="hs-identifier">es</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Combinatorics.Poset.html#hasseDigraph"><span class="hs-identifier hs-var">hasseDigraph</span></a><span> </span><a href="#local-6989586621679181010"><span class="hs-identifier hs-var">poset</span></a><span>
</span><a name="line-183"></a><span>              </span><span class="hs-keyword">in</span><span> </span><a href="Math.Algebras.VectorSpace.html#sumv"><span class="hs-identifier hs-var">sumv</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a href="#local-6989586621679181010"><span class="hs-identifier hs-var">poset</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181013"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679181014"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679181013"><a href="#local-6989586621679181013"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679181014"><a href="#local-6989586621679181014"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679181012"><span class="hs-identifier hs-var">es</span></a><span class="hs-special">]</span><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span class="hs-comment">-- |A function (ie element of the incidence algebra) that counts the number of maximal chains in each interval</span><span>
</span><a name="line-186"></a><span class="hs-identifier">numMaximalChainsIA</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679180918"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679180918"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Math.Combinatorics.Poset.html#Poset"><span class="hs-identifier hs-type">Poset</span></a><span> </span><a href="#local-6989586621679180918"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.Algebras.VectorSpace.html#Vect"><span class="hs-identifier hs-type">Vect</span></a><span> </span><a href="Math.Algebra.Field.Base.html#Q"><span class="hs-identifier hs-type">Q</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-6989586621679180918"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-187"></a><a name="numMaximalChainsIA"><a href="Math.Combinatorics.IncidenceAlgebra.html#numMaximalChainsIA"><span class="hs-identifier">numMaximalChainsIA</span></a></a><span> </span><a name="local-6989586621679181015"><a href="#local-6989586621679181015"><span class="hs-identifier">poset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#unitIA"><span class="hs-identifier hs-var">unitIA</span></a><span> </span><a href="#local-6989586621679181015"><span class="hs-identifier hs-var">poset</span></a><span> </span><a href="Math.Algebras.VectorSpace.html#%3C-%3E"><span class="hs-operator hs-var">&lt;-&gt;</span></a><span> </span><a href="Math.Combinatorics.IncidenceAlgebra.html#etaIA"><span class="hs-identifier hs-var">etaIA</span></a><span> </span><a href="#local-6989586621679181015"><span class="hs-identifier hs-var">poset</span></a><span class="hs-special">)</span><a href="Math.Core.Utils.html#%5E-"><span class="hs-operator hs-var">^-</span></a><span class="hs-number">1</span><span>
</span><a name="line-188"></a><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span class="hs-comment">-- In order to quickCheck this, we would need</span><span>
</span><a name="line-191"></a><span class="hs-comment">-- (i) Custom Arbitrary instance - which uses only valid intervals for the poset (ie elts of the basis)</span><span>
</span><a name="line-192"></a><span class="hs-comment">-- (ii) Custom quickCheck property, which uses the correct unit</span><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span class="hs-comment">-- SOME KNOWN MOBIUS FUNCTIONS</span><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><a name="muC"><a href="Math.Combinatorics.IncidenceAlgebra.html#muC"><span class="hs-identifier">muC</span></a></a><span> </span><a name="local-6989586621679181016"><a href="#local-6989586621679181016"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679181017"><span class="hs-identifier hs-var">mu'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181021"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679181022"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><a href="Math.Algebras.VectorSpace.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a href="#local-6989586621679181018"><span class="hs-identifier hs-var">poset</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181021"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679181022"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679181021"><a href="#local-6989586621679181021"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621679181022"><a href="#local-6989586621679181022"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Math.Combinatorics.Poset.html#intervals"><span class="hs-identifier hs-var">intervals</span></a><span> </span><a href="#local-6989586621679181018"><span class="hs-identifier hs-var">poset</span></a><span class="hs-special">]</span><span>
</span><a name="line-198"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679181017"><a href="#local-6989586621679181017"><span class="hs-identifier">mu'</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679181019"><a href="#local-6989586621679181019"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621679181020"><a href="#local-6989586621679181020"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679181019"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679181020"><span class="hs-identifier hs-var">b</span></a><span>    </span><span class="hs-glyph">=</span><span>  </span><span class="hs-number">1</span><span>
</span><a name="line-199"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679181019"><span class="hs-identifier hs-var">a</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679181020"><span class="hs-identifier hs-var">b</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span class="hs-number">1</span><span>
</span><a name="line-200"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-number">0</span><span>
</span><a name="line-201"></a><span>          </span><a name="local-6989586621679181018"><a href="#local-6989586621679181018"><span class="hs-identifier">poset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Combinatorics.Poset.html#chainN"><span class="hs-identifier hs-var">chainN</span></a><span> </span><a href="#local-6989586621679181016"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><a name="muB"><a href="Math.Combinatorics.IncidenceAlgebra.html#muB"><span class="hs-identifier">muB</span></a></a><span> </span><a name="local-6989586621679181023"><a href="#local-6989586621679181023"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebras.VectorSpace.html#sumv"><span class="hs-identifier hs-var">sumv</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-operator hs-var">^</span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679181026"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679181025"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><a href="Math.Algebras.VectorSpace.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a href="#local-6989586621679181024"><span class="hs-identifier hs-var">poset</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181025"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679181026"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679181025"><a href="#local-6989586621679181025"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621679181026"><a href="#local-6989586621679181026"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Math.Combinatorics.Poset.html#intervals"><span class="hs-identifier hs-var">intervals</span></a><span> </span><a href="#local-6989586621679181024"><span class="hs-identifier hs-var">poset</span></a><span class="hs-special">]</span><span>
</span><a name="line-204"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679181024"><a href="#local-6989586621679181024"><span class="hs-identifier">poset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Combinatorics.Poset.html#posetB"><span class="hs-identifier hs-var">posetB</span></a><span> </span><a href="#local-6989586621679181023"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-205"></a><span class="hs-comment">-- van Lint &amp; Wilson p335</span><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><a name="muL"><a href="Math.Combinatorics.IncidenceAlgebra.html#muL"><span class="hs-identifier">muL</span></a></a><span> </span><a name="local-6989586621679181027"><a href="#local-6989586621679181027"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679181028"><a href="#local-6989586621679181028"><span class="hs-identifier">fq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebras.VectorSpace.html#sumv"><span class="hs-identifier hs-var">sumv</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-operator hs-var">^</span><a href="#local-6989586621679181033"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679181029"><span class="hs-identifier hs-var">q</span></a><span class="hs-operator hs-var">^</span><span class="hs-special">(</span><a href="#local-6989586621679181033"><span class="hs-identifier hs-var">k</span></a><span class="hs-operator hs-var">*</span><span class="hs-special">(</span><a href="#local-6989586621679181033"><span class="hs-identifier hs-var">k</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><a href="Math.Algebras.VectorSpace.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a href="#local-6989586621679181030"><span class="hs-identifier hs-var">poset</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181031"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679181032"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span>
</span><a name="line-208"></a><span>                  </span><span class="hs-special">(</span><a name="local-6989586621679181031"><a href="#local-6989586621679181031"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621679181032"><a href="#local-6989586621679181032"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Math.Combinatorics.Poset.html#intervals"><span class="hs-identifier hs-var">intervals</span></a><span> </span><a href="#local-6989586621679181030"><span class="hs-identifier hs-var">poset</span></a><span class="hs-special">,</span><span>
</span><a name="line-209"></a><span>                  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679181033"><a href="#local-6989586621679181033"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679181032"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679181031"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- the difference in dimensions</span><span>
</span><a name="line-210"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679181029"><a href="#local-6989586621679181029"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679181028"><span class="hs-identifier hs-var">fq</span></a><span>
</span><a name="line-211"></a><span>          </span><a name="local-6989586621679181030"><a href="#local-6989586621679181030"><span class="hs-identifier">poset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Combinatorics.Poset.html#posetL"><span class="hs-identifier hs-var">posetL</span></a><span> </span><a href="#local-6989586621679181027"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679181028"><span class="hs-identifier hs-var">fq</span></a><span>
</span><a name="line-212"></a><span class="hs-comment">-- van Lint &amp; Wilson p335</span><span>
</span><a name="line-213"></a><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span class="hs-comment">-- INCIDENCE COALGEBRA</span><span>
</span><a name="line-216"></a><span class="hs-comment">-- Schmitt, Incidence Hopf Algebras</span><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679181041"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679181041"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679181042"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Math.Algebras.Structures.html#Coalgebra"><span class="hs-identifier hs-type">Coalgebra</span></a><span> </span><a href="#local-6989586621679181041"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-6989586621679181042"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-219"></a><span>    </span><a name="local-8214565720323845980"><a href="Math.Algebras.Structures.html#counit"><span class="hs-identifier">counit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebras.VectorSpace.html#unwrap"><span class="hs-identifier hs-var">unwrap</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Math.Algebras.VectorSpace.html#linear"><span class="hs-identifier hs-var">linear</span></a><span> </span><a href="#local-6989586621679181043"><span class="hs-identifier hs-var">counit'</span></a><span>
</span><a name="line-220"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679181043"><a href="#local-6989586621679181043"><span class="hs-identifier">counit'</span></a></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679181044"><a href="#local-6989586621679181044"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679181045"><a href="#local-6989586621679181045"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679181044"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679181045"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><a href="Math.Algebras.VectorSpace.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-221"></a><span>    </span><a name="local-8214565720323845981"><a href="Math.Algebras.Structures.html#comult"><span class="hs-identifier">comult</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebras.VectorSpace.html#linear"><span class="hs-identifier hs-var">linear</span></a><span> </span><a href="#local-6989586621679181046"><span class="hs-identifier hs-var">comult'</span></a><span>
</span><a name="line-222"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679181046"><a href="#local-6989586621679181046"><span class="hs-identifier">comult'</span></a></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a name="local-6989586621679181047"><a href="#local-6989586621679181047"><span class="hs-identifier">poset</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679181048"><a href="#local-6989586621679181048"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679181049"><a href="#local-6989586621679181049"><span class="hs-identifier">z</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebras.VectorSpace.html#sumv"><span class="hs-identifier hs-var">sumv</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a href="#local-6989586621679181047"><span class="hs-identifier hs-var">poset</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181048"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679181050"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a href="#local-6989586621679181047"><span class="hs-identifier hs-var">poset</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181050"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><a href="#local-6989586621679181049"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679181050"><a href="#local-6989586621679181050"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Math.Combinatorics.Poset.html#interval"><span class="hs-identifier hs-var">interval</span></a><span> </span><a href="#local-6989586621679181047"><span class="hs-identifier hs-var">poset</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181048"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679181049"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><span class="hs-comment">-- So comultiplication in the incidence coalgebra is about decomposition of intervals into subintervals</span><span>
</span><a name="line-225"></a><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span class="hs-comment">-- But for incidence Hopf algebras, Schmitt wants the basis elts to be isomorphism classes of intervals, not intervals themselves</span><span>
</span><a name="line-228"></a><span class="hs-comment">-- (ie unlabelled intervals)</span><span>
</span><a name="line-229"></a><span>
</span><a name="line-230"></a><span class="hs-comment">-- |@toIsoClasses@ is the linear map from the incidence Hopf algebra of a poset to itself,</span><span>
</span><a name="line-231"></a><span class="hs-comment">-- in which each interval is mapped to (the minimal representative of) its isomorphism class.</span><span>
</span><a name="line-232"></a><span class="hs-comment">-- Thus the result can be considered as a linear combination of isomorphism classes of intervals,</span><span>
</span><a name="line-233"></a><span class="hs-comment">-- rather than of intervals themselves.</span><span>
</span><a name="line-234"></a><span class="hs-comment">-- Note that if this operation is to be performed repeatedly for the same poset,</span><span>
</span><a name="line-235"></a><span class="hs-comment">-- then it is more efficient to use @toIsoClasses' poset@, which memoizes the isomorphism class lookup table.</span><span>
</span><a name="line-236"></a><span class="hs-identifier">toIsoClasses</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679180916"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679180916"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679180917"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Math.Algebras.VectorSpace.html#Vect"><span class="hs-identifier hs-type">Vect</span></a><span> </span><a href="#local-6989586621679180916"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-6989586621679180917"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.Algebras.VectorSpace.html#Vect"><span class="hs-identifier hs-type">Vect</span></a><span> </span><a href="#local-6989586621679180916"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-6989586621679180917"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-237"></a><a name="toIsoClasses"><a href="Math.Combinatorics.IncidenceAlgebra.html#toIsoClasses"><span class="hs-identifier">toIsoClasses</span></a></a><span> </span><a name="local-6989586621679181034"><a href="#local-6989586621679181034"><span class="hs-identifier">v</span></a></a><span>
</span><a name="line-238"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679181034"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Math.Algebras.VectorSpace.html#zerov"><span class="hs-identifier hs-var">zerov</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebras.VectorSpace.html#zerov"><span class="hs-identifier hs-var">zerov</span></a><span>
</span><a name="line-239"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Combinatorics.IncidenceAlgebra.html#toIsoClasses%27"><span class="hs-identifier hs-var">toIsoClasses'</span></a><span> </span><a href="#local-6989586621679181035"><span class="hs-identifier hs-var">poset</span></a><span> </span><a href="#local-6989586621679181034"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-240"></a><span>    </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Iv"><span class="hs-identifier hs-var">Iv</span></a><span> </span><a name="local-6989586621679181035"><a href="#local-6989586621679181035"><span class="hs-identifier">poset</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Math.Algebras.VectorSpace.html#terms"><span class="hs-identifier hs-var">terms</span></a><span> </span><a href="#local-6989586621679181034"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-241"></a><span>
</span><a name="line-242"></a><span class="hs-comment">-- |Given a poset, @toIsoClasses' poset@ is the linear map from the incidence Hopf algebra of the poset to itself,</span><span>
</span><a name="line-243"></a><span class="hs-comment">-- in which each interval is mapped to (the minimal representative of) its isomorphism class.</span><span>
</span><a name="line-244"></a><span class="hs-identifier">toIsoClasses'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679180914"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679180914"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679180915"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Math.Combinatorics.Poset.html#Poset"><span class="hs-identifier hs-type">Poset</span></a><span> </span><a href="#local-6989586621679180915"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.Algebras.VectorSpace.html#Vect"><span class="hs-identifier hs-type">Vect</span></a><span> </span><a href="#local-6989586621679180914"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-6989586621679180915"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.Algebras.VectorSpace.html#Vect"><span class="hs-identifier hs-type">Vect</span></a><span> </span><a href="#local-6989586621679180914"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Math.Combinatorics.IncidenceAlgebra.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-6989586621679180915"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-245"></a><a name="toIsoClasses%27"><a href="Math.Combinatorics.IncidenceAlgebra.html#toIsoClasses%27"><span class="hs-identifier">toIsoClasses'</span></a></a><span> </span><a name="local-6989586621679181036"><a href="#local-6989586621679181036"><span class="hs-identifier">poset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebras.VectorSpace.html#linear"><span class="hs-identifier hs-var">linear</span></a><span> </span><a href="#local-6989586621679181037"><span class="hs-identifier hs-var">isoRep</span></a><span>
</span><a name="line-246"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679181037"><a href="#local-6989586621679181037"><span class="hs-identifier">isoRep</span></a></a><span> </span><a name="local-6989586621679181039"><a href="#local-6989586621679181039"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679181038"><span class="hs-identifier hs-var">isoMap</span></a><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.!</span><span> </span><a href="#local-6989586621679181039"><span class="hs-identifier hs-var">iv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-247"></a><span>                      </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679181039"><span class="hs-identifier hs-var">iv</span></a><span>
</span><a name="line-248"></a><span>                      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679181040"><a href="#local-6989586621679181040"><span class="hs-identifier">iv'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679181040"><span class="hs-identifier hs-var">iv'</span></a><span>
</span><a name="line-249"></a><span>          </span><a name="local-6989586621679181038"><a href="#local-6989586621679181038"><span class="hs-identifier">isoMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Combinatorics.IncidenceAlgebra.html#intervalIsoMap"><span class="hs-identifier hs-var">intervalIsoMap</span></a><span> </span><a href="#local-6989586621679181036"><span class="hs-identifier hs-var">poset</span></a><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span>
</span><a name="line-252"></a><span class="hs-comment">{-
-- for example:

&gt; toIsoClasses $ zetaIA $ posetP 4
15Iv ([[1],[2],[3],[4]],[[1],[2],[3],[4]])+31Iv ([[1],[2],[3],[4]],[[1],[2],[3,4]])+10Iv ([[1],[2],[3],[4]],[[1],[2,3,4]])+3Iv ([[1],[2],[3],[4]],[[1,2],[3,4]])+Iv ([[1],[2],[3],[4]],[[1,2,3,4]])

-- Can we use this to solve &quot;counting squares&quot; problems

&gt; let b3 = comult $ return $ Iv (posetB 3) ([],[1,2,3])
&gt; let isoB3 = toIsoClasses' $ posetB 3
&gt; (isoB3 `tf` isoB3) b3
(Iv ([],[]),Iv ([],[1,2,3]))+3(Iv ([],[1]),Iv ([],[1,2]))+3(Iv ([],[1,2]),Iv ([],[1]))+(Iv ([],[1,2,3]),Iv ([],[]))

-- The incidence coalgebra of the binomial poset is isomorphic to the binomial coalgebra

-- if we just want to get the coefficients, we don't need to use comult:

&gt; let poset@(Poset (set,po)) = posetB 3 in toIsoClasses $ sumv [return (Iv poset ([],x)) | x &lt;- set]
Iv ([],[])+3Iv ([],[1])+3Iv ([],[1,2])+Iv ([],[1,2,3])

&gt; let n = 4; p  = comult $ return $ Iv (posetP n) ([[i] | i&lt;- [1..n]],[[1..n]]); iso = toIsoClasses' (posetP n) in (iso `tf` iso) p
(Iv ([[1],[2],[3],[4]],[[1],[2],[3],[4]]),Iv ([[1],[2],[3],[4]],[[1,2,3,4]]))+
6(Iv ([[1],[2],[3],[4]],[[1],[2],[3,4]]),Iv ([[1],[2],[3],[4]],[[1],[2,3,4]]))+
4(Iv ([[1],[2],[3],[4]],[[1],[2,3,4]]),Iv ([[1],[2],[3],[4]],[[1],[2],[3,4]]))+
3(Iv ([[1],[2],[3],[4]],[[1,2],[3,4]]),Iv ([[1],[2],[3],[4]],[[1],[2],[3,4]]))+
(Iv ([[1],[2],[3],[4]],[[1,2,3,4]]),Iv ([[1],[2],[3],[4]],[[1],[2],[3],[4]]))

-- These are multinomial coefficients, OEIS A178867: 1; 1,1; 1,3,1; 1,6,4,3,1; 1,10,10,15,5,10,1; ...
-- Although A036040, which is the same up to ordering, seems a better match. (Our order is fairly arbitrary)

&gt; let n = 4; p  = comult $ return $ Iv (posetL n f2) ([],[[1 :: F2,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]); iso = toIsoClasses' (posetL n f2) in (iso `tf` iso) p
(Iv ([],[]),Iv ([],[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]))+
15(Iv ([],[[0,0,0,1]]),Iv ([],[[0,1,0,0],[0,0,1,0],[0,0,0,1]]))+
35(Iv ([],[[0,0,1,0],[0,0,0,1]]),Iv ([],[[0,0,1,0],[0,0,0,1]]))+
15(Iv ([],[[0,1,0,0],[0,0,1,0],[0,0,0,1]]),Iv ([],[[0,0,0,1]]))+
(Iv ([],[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]),Iv ([],[]))

-- With L n fq, we get the q-binomial coefficients, eg OEIS A022166:
1; 1, 1; 1, 3, 1; 1, 7, 7, 1; 1, 15, 35, 15, 1
-}</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span>
</span><a name="line-294"></a><span class="hs-comment">-- This still isn't quite what Schmitt wants</span><span>
</span><a name="line-295"></a><span class="hs-comment">-- Schmitt, IHA, p6</span><span>
</span><a name="line-296"></a><span class="hs-comment">-- The incidence Hopf algebra should have as its basis isomorphism classes of intervals, not intervals</span><span>
</span><a name="line-297"></a><span class="hs-comment">-- The mult is defined as direct product of posets</span><span>
</span><a name="line-298"></a></pre></body></html>