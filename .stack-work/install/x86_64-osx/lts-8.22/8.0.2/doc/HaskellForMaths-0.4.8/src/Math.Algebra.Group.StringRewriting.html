<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- Copyright (c) David Amos, 2008. All rights reserved.</span><span>
</span><a name="line-2"></a><span></span><span>
</span><a name="line-3"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Math</span><span class="hs-operator">.</span><span class="hs-identifier">Algebra</span><span class="hs-operator">.</span><span class="hs-identifier">Group</span><span class="hs-operator">.</span><span class="hs-identifier">StringRewriting</span><span> </span><span class="hs-keyword">where</span><span></span><span>
</span><a name="line-4"></a><span></span><span>
</span><a name="line-5"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">L</span><span></span><span>
</span><a name="line-6"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">catMaybes</span><span class="hs-special">)</span><span></span><span>
</span><a name="line-7"></a><span></span><span>
</span><a name="line-8"></a><span class="hs-comment">-- REWRITING</span><span>
</span><a name="line-9"></a><span></span><span>
</span><a name="line-10"></a><span class="hs-comment">-- |Given a list of rewrite rules of the form (left,right), and a word,</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- rewrite it by repeatedly replacing any left substring in the word by the corresponding right</span><span>
</span><a name="line-12"></a><span class="hs-identifier">rewrite</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679093373"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621679093373"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679093373"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679093373"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679093373"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span></span><span>
</span><a name="line-13"></a><a name="rewrite"><a href="Math.Algebra.Group.StringRewriting.html#rewrite"><span class="hs-identifier">rewrite</span></a></a><span> </span><a name="local-6989586621679093374"><a href="#local-6989586621679093374"><span class="hs-identifier">rules</span></a></a><span> </span><a name="local-6989586621679093375"><a href="#local-6989586621679093375"><span class="hs-identifier">word</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679093376"><span class="hs-identifier hs-var">rewrite'</span></a><span> </span><a href="#local-6989586621679093374"><span class="hs-identifier hs-var">rules</span></a><span> </span><a href="#local-6989586621679093375"><span class="hs-identifier hs-var">word</span></a><span> </span><span class="hs-keyword">where</span><span></span><span>
</span><a name="line-14"></a><span>    </span><a name="local-6989586621679093376"><a href="#local-6989586621679093376"><span class="hs-identifier">rewrite'</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679093377"><a href="#local-6989586621679093377"><span class="hs-identifier">r</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679093378"><a href="#local-6989586621679093378"><span class="hs-identifier">rs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679093379"><a href="#local-6989586621679093379"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span></span><span>
</span><a name="line-15"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#rewrite1"><span class="hs-identifier hs-var">rewrite1</span></a><span> </span><a href="#local-6989586621679093377"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679093379"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-keyword">of</span><span></span><span>
</span><a name="line-16"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679093376"><span class="hs-identifier hs-var">rewrite'</span></a><span> </span><a href="#local-6989586621679093378"><span class="hs-identifier hs-var">rs</span></a><span> </span><a href="#local-6989586621679093379"><span class="hs-identifier hs-var">xs</span></a><span></span><span>
</span><a name="line-17"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679093380"><a href="#local-6989586621679093380"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679093376"><span class="hs-identifier hs-var">rewrite'</span></a><span> </span><a href="#local-6989586621679093374"><span class="hs-identifier hs-var">rules</span></a><span> </span><a href="#local-6989586621679093380"><span class="hs-identifier hs-var">ys</span></a><span></span><span>
</span><a name="line-18"></a><span>    </span><span class="hs-identifier">rewrite'</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679093381"><a href="#local-6989586621679093381"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679093381"><span class="hs-identifier hs-var">xs</span></a><span></span><span>
</span><a name="line-19"></a><span></span><span>
</span><a name="line-20"></a><a name="rewrite1"><a href="Math.Algebra.Group.StringRewriting.html#rewrite1"><span class="hs-identifier">rewrite1</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679093382"><a href="#local-6989586621679093382"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093383"><a href="#local-6989586621679093383"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679093384"><a href="#local-6989586621679093384"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span></span><span>
</span><a name="line-21"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679093384"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-special">`</span><a href="Math.Algebra.Group.StringRewriting.html#splitSubstring"><span class="hs-identifier hs-var">splitSubstring</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679093382"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-keyword">of</span><span></span><span>
</span><a name="line-22"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span></span><span>
</span><a name="line-23"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679093385"><a href="#local-6989586621679093385"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093386"><a href="#local-6989586621679093386"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093385"><span class="hs-identifier hs-var">a</span></a><span class="hs-operator hs-var">++</span><a href="#local-6989586621679093383"><span class="hs-identifier hs-var">r</span></a><span class="hs-operator hs-var">++</span><a href="#local-6989586621679093386"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span></span><span>
</span><a name="line-24"></a><span></span><span>
</span><a name="line-25"></a><span class="hs-comment">-- given a string x and a substring b, find if possible (a,c) such that xs = abc</span><span>
</span><a name="line-26"></a><a name="splitSubstring"><a href="Math.Algebra.Group.StringRewriting.html#splitSubstring"><span class="hs-identifier">splitSubstring</span></a></a><span> </span><a name="local-6989586621679093387"><a href="#local-6989586621679093387"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-6989586621679093388"><a href="#local-6989586621679093388"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679093389"><span class="hs-identifier hs-var">splitSubstring'</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679093387"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-keyword">where</span><span></span><span>
</span><a name="line-27"></a><span>    </span><a name="local-6989586621679093389"><a href="#local-6989586621679093389"><span class="hs-identifier">splitSubstring'</span></a></a><span> </span><a name="local-6989586621679093390"><a href="#local-6989586621679093390"><span class="hs-identifier">ls</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span></span><span>
</span><a name="line-28"></a><span>    </span><span class="hs-identifier">splitSubstring'</span><span> </span><a name="local-6989586621679093391"><a href="#local-6989586621679093391"><span class="hs-identifier">ls</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679093392"><a href="#local-6989586621679093392"><span class="hs-identifier">r</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679093393"><a href="#local-6989586621679093393"><span class="hs-identifier">rs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span></span><span>
</span><a name="line-29"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679093388"><span class="hs-identifier hs-var">ys</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093392"><span class="hs-identifier hs-var">r</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679093393"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span></span><span>
</span><a name="line-30"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621679093391"><span class="hs-identifier hs-var">ls</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679093388"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093392"><span class="hs-identifier hs-var">r</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679093393"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span></span><span>
</span><a name="line-31"></a><span>        </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679093389"><span class="hs-identifier hs-var">splitSubstring'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093392"><span class="hs-identifier hs-var">r</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679093391"><span class="hs-identifier hs-var">ls</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679093393"><span class="hs-identifier hs-var">rs</span></a><span></span><span>
</span><a name="line-32"></a><span class="hs-comment">-- there might be a more efficient way to do this</span><span>
</span><a name="line-33"></a><span></span><span>
</span><a name="line-34"></a><span></span><span>
</span><a name="line-35"></a><span class="hs-comment">-- KNUTH-BENDIX</span><span>
</span><a name="line-36"></a><span></span><span>
</span><a name="line-37"></a><span class="hs-comment">-- given two strings x,y, find if possible a,b,c with x=ab y=bc</span><span>
</span><a name="line-38"></a><a name="findOverlap"><a href="Math.Algebra.Group.StringRewriting.html#findOverlap"><span class="hs-identifier">findOverlap</span></a></a><span> </span><a name="local-6989586621679093394"><a href="#local-6989586621679093394"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-6989586621679093395"><a href="#local-6989586621679093395"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679093396"><span class="hs-identifier hs-var">findOverlap'</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679093394"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621679093395"><span class="hs-identifier hs-var">ys</span></a><span> </span><span class="hs-keyword">where</span><span></span><span>
</span><a name="line-39"></a><span>    </span><a name="local-6989586621679093396"><a href="#local-6989586621679093396"><span class="hs-identifier">findOverlap'</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679093398"><a href="#local-6989586621679093398"><span class="hs-identifier">cs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-comment">-- (reverse as, [], cs)</span><span>
</span><a name="line-40"></a><span>    </span><span class="hs-identifier">findOverlap'</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679093400"><a href="#local-6989586621679093400"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679093401"><a href="#local-6989586621679093401"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679093402"><a href="#local-6989586621679093402"><span class="hs-identifier">cs</span></a></a><span> </span><span class="hs-glyph">=</span><span></span><span>
</span><a name="line-41"></a><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093400"><span class="hs-identifier hs-var">b</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679093401"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679093402"><span class="hs-identifier hs-var">cs</span></a><span></span><span>
</span><a name="line-42"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><span class="hs-keyword">as</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679093400"><span class="hs-identifier hs-var">b</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679093401"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093400"><span class="hs-identifier hs-var">b</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679093401"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679093402"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span></span><span>
</span><a name="line-43"></a><span>        </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679093396"><span class="hs-identifier hs-var">findOverlap'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093400"><span class="hs-identifier hs-var">b</span></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679093401"><span class="hs-identifier hs-var">bs</span></a><span> </span><a href="#local-6989586621679093402"><span class="hs-identifier hs-var">cs</span></a><span></span><span>
</span><a name="line-44"></a><span class="hs-comment">-- there might be a more efficient way to do this</span><span>
</span><a name="line-45"></a><span></span><span>
</span><a name="line-46"></a><span class="hs-comment">-- note that findOverlap &quot;abab&quot; &quot;abab&quot; won't find the partial overlap (&quot;ab&quot;,&quot;ab&quot;,&quot;ab&quot;)</span><span>
</span><a name="line-47"></a><span></span><span>
</span><a name="line-48"></a><span class="hs-comment">-- Knuth-Bendix algorithm</span><span>
</span><a name="line-49"></a><span class="hs-comment">-- http://en.wikipedia.org/wiki/Knuth-Bendix_algorithm</span><span>
</span><a name="line-50"></a><span class="hs-comment">-- Given a set of rules (assumed already reduced with respect to each other)</span><span>
</span><a name="line-51"></a><span class="hs-comment">-- return a confluent rewrite system</span><span>
</span><a name="line-52"></a><a name="knuthBendix1"><a href="Math.Algebra.Group.StringRewriting.html#knuthBendix1"><span class="hs-identifier">knuthBendix1</span></a></a><span> </span><a name="local-6989586621679093403"><a href="#local-6989586621679093403"><span class="hs-identifier">rules</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679093405"><span class="hs-identifier hs-var">knuthBendix'</span></a><span> </span><a href="#local-6989586621679093403"><span class="hs-identifier hs-var">rules</span></a><span> </span><a href="#local-6989586621679093404"><span class="hs-identifier hs-var">pairs</span></a><span> </span><span class="hs-keyword">where</span><span></span><span>
</span><a name="line-53"></a><span>    </span><a name="local-6989586621679093404"><a href="#local-6989586621679093404"><span class="hs-identifier">pairs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679093407"><span class="hs-identifier hs-var">lri</span></a><span class="hs-special">,</span><a href="#local-6989586621679093408"><span class="hs-identifier hs-var">lrj</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679093407"><a href="#local-6989586621679093407"><span class="hs-identifier">lri</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679093403"><span class="hs-identifier hs-var">rules</span></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679093408"><a href="#local-6989586621679093408"><span class="hs-identifier">lrj</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679093403"><span class="hs-identifier hs-var">rules</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679093407"><span class="hs-identifier hs-var">lri</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679093408"><span class="hs-identifier hs-var">lrj</span></a><span class="hs-special">]</span><span></span><span>
</span><a name="line-54"></a><span>    </span><a name="local-6989586621679093405"><a href="#local-6989586621679093405"><span class="hs-identifier">knuthBendix'</span></a></a><span> </span><a name="local-6989586621679093409"><a href="#local-6989586621679093409"><span class="hs-identifier">rules</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679093409"><span class="hs-identifier hs-var">rules</span></a><span> </span><span class="hs-comment">-- should reduce in some way</span><span>
</span><a name="line-55"></a><span>    </span><span class="hs-identifier">knuthBendix'</span><span> </span><a name="local-6989586621679093410"><a href="#local-6989586621679093410"><span class="hs-identifier">rules</span></a></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679093411"><a href="#local-6989586621679093411"><span class="hs-identifier">li</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093412"><a href="#local-6989586621679093412"><span class="hs-identifier">ri</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><a name="local-6989586621679093413"><a href="#local-6989586621679093413"><span class="hs-identifier">lj</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093414"><a href="#local-6989586621679093414"><span class="hs-identifier">rj</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679093415"><a href="#local-6989586621679093415"><span class="hs-identifier">ps</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span></span><span>
</span><a name="line-56"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#findOverlap"><span class="hs-identifier hs-var">findOverlap</span></a><span> </span><a href="#local-6989586621679093411"><span class="hs-identifier hs-var">li</span></a><span> </span><a href="#local-6989586621679093413"><span class="hs-identifier hs-var">lj</span></a><span> </span><span class="hs-keyword">of</span><span></span><span>
</span><a name="line-57"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679093405"><span class="hs-identifier hs-var">knuthBendix'</span></a><span> </span><a href="#local-6989586621679093410"><span class="hs-identifier hs-var">rules</span></a><span> </span><a href="#local-6989586621679093415"><span class="hs-identifier hs-var">ps</span></a><span></span><span>
</span><a name="line-58"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679093416"><a href="#local-6989586621679093416"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093417"><a href="#local-6989586621679093417"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093418"><a href="#local-6989586621679093418"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#ordpair"><span class="hs-identifier hs-var">ordpair</span></a><span> </span><span class="hs-special">(</span><a href="Math.Algebra.Group.StringRewriting.html#rewrite"><span class="hs-identifier hs-var">rewrite</span></a><span> </span><a href="#local-6989586621679093410"><span class="hs-identifier hs-var">rules</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093412"><span class="hs-identifier hs-var">ri</span></a><span class="hs-operator hs-var">++</span><a href="#local-6989586621679093418"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Math.Algebra.Group.StringRewriting.html#rewrite"><span class="hs-identifier hs-var">rewrite</span></a><span> </span><a href="#local-6989586621679093410"><span class="hs-identifier hs-var">rules</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093416"><span class="hs-identifier hs-var">a</span></a><span class="hs-operator hs-var">++</span><a href="#local-6989586621679093414"><span class="hs-identifier hs-var">rj</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span></span><span>
</span><a name="line-59"></a><span>                        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679093405"><span class="hs-identifier hs-var">knuthBendix'</span></a><span> </span><a href="#local-6989586621679093410"><span class="hs-identifier hs-var">rules</span></a><span> </span><a href="#local-6989586621679093415"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-comment">-- they both reduce to the same thing</span><span>
</span><a name="line-60"></a><span>                        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679093419"><a href="#local-6989586621679093419"><span class="hs-identifier">rule'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679093420"><a href="#local-6989586621679093420"><span class="hs-identifier">rules'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679093406"><span class="hs-identifier hs-var">reduce</span></a><span> </span><a href="#local-6989586621679093419"><span class="hs-identifier hs-var">rule'</span></a><span> </span><a href="#local-6989586621679093410"><span class="hs-identifier hs-var">rules</span></a><span></span><span>
</span><a name="line-61"></a><span>                                          </span><a name="local-6989586621679093421"><a href="#local-6989586621679093421"><span class="hs-identifier">ps'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679093415"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679093419"><span class="hs-identifier hs-var">rule'</span></a><span class="hs-special">,</span><a href="#local-6989586621679093422"><span class="hs-identifier hs-var">rule</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679093422"><a href="#local-6989586621679093422"><span class="hs-identifier">rule</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679093420"><span class="hs-identifier hs-var">rules'</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679093423"><span class="hs-identifier hs-var">rule</span></a><span class="hs-special">,</span><a href="#local-6989586621679093419"><span class="hs-identifier hs-var">rule'</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679093423"><a href="#local-6989586621679093423"><span class="hs-identifier">rule</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679093420"><span class="hs-identifier hs-var">rules'</span></a><span class="hs-special">]</span><span></span><span>
</span><a name="line-62"></a><span>                                      </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679093405"><span class="hs-identifier hs-var">knuthBendix'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093419"><span class="hs-identifier hs-var">rule'</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679093420"><span class="hs-identifier hs-var">rules'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679093421"><span class="hs-identifier hs-var">ps'</span></a><span></span><span>
</span><a name="line-63"></a><span>                    	</span><span class="hs-comment">-- the new rule comes from seeing that</span><span>
</span><a name="line-64"></a><span>                    	</span><span class="hs-comment">-- a ++ b ++ c == l1 ++ c -&gt; r1 ++ c (by rule 1)</span><span>
</span><a name="line-65"></a><span>                    	</span><span class="hs-comment">-- a ++ b ++ c == a ++ l2 -&gt; a ++ r2 (by rule 2)</span><span>
</span><a name="line-66"></a><span>    </span><a name="local-6989586621679093406"><a href="#local-6989586621679093406"><span class="hs-identifier">reduce</span></a></a><span> </span><a name="local-6989586621679093424"><a href="#local-6989586621679093424"><span class="hs-identifier">rule</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679093425"><a href="#local-6989586621679093425"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093426"><a href="#local-6989586621679093426"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679093427"><a href="#local-6989586621679093427"><span class="hs-identifier">rules</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679093428"><a href="#local-6989586621679093428"><span class="hs-identifier">l'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093429"><a href="#local-6989586621679093429"><span class="hs-identifier">r'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">isInfixOf</span><span> </span><a href="#local-6989586621679093425"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679093428"><span class="hs-identifier hs-var">l'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679093427"><span class="hs-identifier hs-var">rules</span></a><span></span><span>
</span><a name="line-67"></a><span>        </span><span class="hs-comment">-- [rule' | rule'@(l',r') &lt;- rules, not (l `L.isInfixOf` l')]</span><span>
</span><a name="line-68"></a><span></span><span>
</span><a name="line-69"></a><a name="ordpair"><a href="Math.Algebra.Group.StringRewriting.html#ordpair"><span class="hs-identifier">ordpair</span></a></a><span> </span><a name="local-6989586621679093430"><a href="#local-6989586621679093430"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679093431"><a href="#local-6989586621679093431"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span></span><span>
</span><a name="line-70"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#shortlex"><span class="hs-identifier hs-var">shortlex</span></a><span> </span><a href="#local-6989586621679093430"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679093431"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-keyword">of</span><span></span><span>
</span><a name="line-71"></a><span>    </span><span class="hs-identifier hs-var">LT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093431"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><a href="#local-6989586621679093430"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span></span><span>
</span><a name="line-72"></a><span>    </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span></span><span>
</span><a name="line-73"></a><span>    </span><span class="hs-identifier hs-var">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093430"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679093431"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span></span><span>
</span><a name="line-74"></a><span></span><span>
</span><a name="line-75"></a><a name="shortlex"><a href="Math.Algebra.Group.StringRewriting.html#shortlex"><span class="hs-identifier">shortlex</span></a></a><span> </span><a name="local-6989586621679093432"><a href="#local-6989586621679093432"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679093433"><a href="#local-6989586621679093433"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">compare</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679093432"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679093432"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679093433"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679093433"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span></span><span>
</span><a name="line-76"></a><span></span><span>
</span><a name="line-77"></a><span class="hs-comment">-- for groups, where &quot;letters&quot; will take the form Either a a, we will want a different order, because we will want x^-1 -&gt; x^3 to be the right way round</span><span>
</span><a name="line-78"></a><span></span><span>
</span><a name="line-79"></a><span></span><span>
</span><a name="line-80"></a><span class="hs-comment">-- An optimisation - keep the rules ordered smallest first, and process the pairs smallest first</span><span>
</span><a name="line-81"></a><span class="hs-comment">-- Appears to be significantly faster on average</span><span>
</span><a name="line-82"></a><a name="knuthBendix2"><a href="Math.Algebra.Group.StringRewriting.html#knuthBendix2"><span class="hs-identifier">knuthBendix2</span></a></a><span> </span><a name="local-6989586621679093434"><a href="#local-6989586621679093434"><span class="hs-identifier">rules</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679093437"><span class="hs-identifier hs-var">knuthBendix'</span></a><span> </span><a href="#local-6989586621679093435"><span class="hs-identifier hs-var">rules'</span></a><span> </span><a href="#local-6989586621679093436"><span class="hs-identifier hs-var">pairs</span></a><span> </span><span class="hs-keyword">where</span><span></span><span>
</span><a name="line-83"></a><span>    </span><a name="local-6989586621679093435"><a href="#local-6989586621679093435"><span class="hs-identifier">rules'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">sort</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679093440"><span class="hs-identifier hs-var">sizedRule</span></a><span> </span><a href="#local-6989586621679093434"><span class="hs-identifier hs-var">rules</span></a><span></span><span>
</span><a name="line-84"></a><span>    </span><a name="local-6989586621679093436"><a href="#local-6989586621679093436"><span class="hs-identifier">pairs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">sort</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679093441"><span class="hs-identifier hs-var">sizedPair</span></a><span> </span><a href="#local-6989586621679093442"><span class="hs-identifier hs-var">sri</span></a><span> </span><a href="#local-6989586621679093443"><span class="hs-identifier hs-var">srj</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679093442"><a href="#local-6989586621679093442"><span class="hs-identifier">sri</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679093435"><span class="hs-identifier hs-var">rules'</span></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679093443"><a href="#local-6989586621679093443"><span class="hs-identifier">srj</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679093435"><span class="hs-identifier hs-var">rules'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679093442"><span class="hs-identifier hs-var">sri</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679093443"><span class="hs-identifier hs-var">srj</span></a><span class="hs-special">]</span><span></span><span>
</span><a name="line-85"></a><span>    </span><a name="local-6989586621679093437"><a href="#local-6989586621679093437"><span class="hs-identifier">knuthBendix'</span></a></a><span> </span><a name="local-6989586621679093444"><a href="#local-6989586621679093444"><span class="hs-identifier">rules</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679093444"><span class="hs-identifier hs-var">rules</span></a><span></span><span>
</span><a name="line-86"></a><span>    </span><span class="hs-identifier">knuthBendix'</span><span> </span><a name="local-6989586621679093445"><a href="#local-6989586621679093445"><span class="hs-identifier">rules</span></a></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679093446"><a href="#local-6989586621679093446"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><span class="hs-special">(</span><a name="local-6989586621679093447"><a href="#local-6989586621679093447"><span class="hs-identifier">li</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093448"><a href="#local-6989586621679093448"><span class="hs-identifier">ri</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><a name="local-6989586621679093449"><a href="#local-6989586621679093449"><span class="hs-identifier">lj</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093450"><a href="#local-6989586621679093450"><span class="hs-identifier">rj</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679093451"><a href="#local-6989586621679093451"><span class="hs-identifier">ps</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span></span><span>
</span><a name="line-87"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#findOverlap"><span class="hs-identifier hs-var">findOverlap</span></a><span> </span><a href="#local-6989586621679093447"><span class="hs-identifier hs-var">li</span></a><span> </span><a href="#local-6989586621679093449"><span class="hs-identifier hs-var">lj</span></a><span> </span><span class="hs-keyword">of</span><span></span><span>
</span><a name="line-88"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679093437"><span class="hs-identifier hs-var">knuthBendix'</span></a><span> </span><a href="#local-6989586621679093445"><span class="hs-identifier hs-var">rules</span></a><span> </span><a href="#local-6989586621679093451"><span class="hs-identifier hs-var">ps</span></a><span></span><span>
</span><a name="line-89"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679093452"><a href="#local-6989586621679093452"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093453"><a href="#local-6989586621679093453"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093454"><a href="#local-6989586621679093454"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679093439"><span class="hs-identifier hs-var">ordpair</span></a><span> </span><span class="hs-special">(</span><a href="Math.Algebra.Group.StringRewriting.html#rewrite"><span class="hs-identifier hs-var">rewrite</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679093445"><span class="hs-identifier hs-var">rules</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093448"><span class="hs-identifier hs-var">ri</span></a><span class="hs-operator hs-var">++</span><a href="#local-6989586621679093454"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Math.Algebra.Group.StringRewriting.html#rewrite"><span class="hs-identifier hs-var">rewrite</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679093445"><span class="hs-identifier hs-var">rules</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093452"><span class="hs-identifier hs-var">a</span></a><span class="hs-operator hs-var">++</span><a href="#local-6989586621679093450"><span class="hs-identifier hs-var">rj</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span></span><span>
</span><a name="line-90"></a><span>                        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679093437"><span class="hs-identifier hs-var">knuthBendix'</span></a><span> </span><a href="#local-6989586621679093445"><span class="hs-identifier hs-var">rules</span></a><span> </span><a href="#local-6989586621679093451"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-comment">-- they both reduce to the same thing</span><span>
</span><a name="line-91"></a><span>                        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679093455"><a href="#local-6989586621679093455"><span class="hs-identifier">rule'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679093456"><a href="#local-6989586621679093456"><span class="hs-identifier">rules'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679093438"><span class="hs-identifier hs-var">reduce</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679093455"><span class="hs-identifier hs-var">rule'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679093445"><span class="hs-identifier hs-var">rules</span></a><span></span><span>
</span><a name="line-92"></a><span>                                          </span><span class="hs-comment">-- ps' = L.sort $ ps ++ [sizedPair rule' rule | rule &lt;- rules'] ++ [sizedPair rule rule' | rule &lt;- rules']</span><span>
</span><a name="line-93"></a><span>                                          </span><a name="local-6989586621679093457"><a href="#local-6989586621679093457"><span class="hs-identifier">ps'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#merge"><span class="hs-identifier hs-var">merge</span></a><span> </span><a href="#local-6989586621679093451"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#merge"><span class="hs-identifier hs-var">merge</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679093441"><span class="hs-identifier hs-var">sizedPair</span></a><span> </span><a href="#local-6989586621679093455"><span class="hs-identifier hs-var">rule'</span></a><span> </span><a href="#local-6989586621679093458"><span class="hs-identifier hs-var">rule</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679093458"><a href="#local-6989586621679093458"><span class="hs-identifier">rule</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679093456"><span class="hs-identifier hs-var">rules'</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679093441"><span class="hs-identifier hs-var">sizedPair</span></a><span> </span><a href="#local-6989586621679093459"><span class="hs-identifier hs-var">rule</span></a><span> </span><a href="#local-6989586621679093455"><span class="hs-identifier hs-var">rule'</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679093459"><a href="#local-6989586621679093459"><span class="hs-identifier">rule</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679093456"><span class="hs-identifier hs-var">rules'</span></a><span class="hs-special">]</span><span></span><span>
</span><a name="line-94"></a><span>                                     </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679093437"><span class="hs-identifier hs-var">knuthBendix'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span><span> </span><a href="#local-6989586621679093455"><span class="hs-identifier hs-var">rule'</span></a><span> </span><a href="#local-6989586621679093456"><span class="hs-identifier hs-var">rules'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679093457"><span class="hs-identifier hs-var">ps'</span></a><span></span><span>
</span><a name="line-95"></a><span>    </span><a name="local-6989586621679093438"><a href="#local-6989586621679093438"><span class="hs-identifier">reduce</span></a></a><span> </span><a name="local-6989586621679093460"><a href="#local-6989586621679093460"><span class="hs-identifier">rule</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679093461"><a href="#local-6989586621679093461"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093462"><a href="#local-6989586621679093462"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679093463"><a href="#local-6989586621679093463"><span class="hs-identifier">rules</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679093464"><a href="#local-6989586621679093464"><span class="hs-identifier">s'</span></a></a><span class="hs-special">,</span><span class="hs-special">(</span><a name="local-6989586621679093465"><a href="#local-6989586621679093465"><span class="hs-identifier">l'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093466"><a href="#local-6989586621679093466"><span class="hs-identifier">r'</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">isInfixOf</span><span> </span><a href="#local-6989586621679093461"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679093465"><span class="hs-identifier hs-var">l'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679093463"><span class="hs-identifier hs-var">rules</span></a><span></span><span>
</span><a name="line-96"></a><span>    </span><span class="hs-comment">-- reduce rule@(l,r) rules = [rule' | rule'@(s',(l',r')) &lt;- rules, not (l `L.isInfixOf` l')]</span><span>
</span><a name="line-97"></a><span>    </span><a name="local-6989586621679093439"><a href="#local-6989586621679093439"><span class="hs-identifier">ordpair</span></a></a><span> </span><a name="local-6989586621679093467"><a href="#local-6989586621679093467"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679093468"><a href="#local-6989586621679093468"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span></span><span>
</span><a name="line-98"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679093469"><a href="#local-6989586621679093469"><span class="hs-identifier">lx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679093467"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">;</span><span> </span><a name="local-6989586621679093470"><a href="#local-6989586621679093470"><span class="hs-identifier">ly</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679093468"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-keyword">in</span><span></span><span>
</span><a name="line-99"></a><span>            </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">compare</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093469"><span class="hs-identifier hs-var">lx</span></a><span class="hs-special">,</span><a href="#local-6989586621679093467"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093470"><span class="hs-identifier hs-var">ly</span></a><span class="hs-special">,</span><a href="#local-6989586621679093468"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span></span><span>
</span><a name="line-100"></a><span>            </span><span class="hs-identifier hs-var">LT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093470"><span class="hs-identifier hs-var">ly</span></a><span class="hs-special">,</span><span class="hs-special">(</span><a href="#local-6989586621679093468"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><a href="#local-6989586621679093467"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093469"><span class="hs-identifier hs-var">lx</span></a><span class="hs-special">,</span><span class="hs-special">(</span><a href="#local-6989586621679093467"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679093468"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span></span><span>
</span><a name="line-101"></a><span>    </span><a name="local-6989586621679093440"><a href="#local-6989586621679093440"><span class="hs-identifier">sizedRule</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679093471"><a href="#local-6989586621679093471"><span class="hs-identifier">rule</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679093472"><a href="#local-6989586621679093472"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093473"><a href="#local-6989586621679093473"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679093472"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679093471"><span class="hs-identifier hs-var">rule</span></a><span class="hs-special">)</span><span></span><span>
</span><a name="line-102"></a><span>    </span><a name="local-6989586621679093441"><a href="#local-6989586621679093441"><span class="hs-identifier">sizedPair</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679093474"><a href="#local-6989586621679093474"><span class="hs-identifier">s1</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093475"><a href="#local-6989586621679093475"><span class="hs-identifier">r1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679093476"><a href="#local-6989586621679093476"><span class="hs-identifier">s2</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093477"><a href="#local-6989586621679093477"><span class="hs-identifier">r2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093474"><span class="hs-identifier hs-var">s1</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679093476"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">,</span><a href="#local-6989586621679093475"><span class="hs-identifier hs-var">r1</span></a><span class="hs-special">,</span><a href="#local-6989586621679093477"><span class="hs-identifier hs-var">r2</span></a><span class="hs-special">)</span><span></span><span>
</span><a name="line-103"></a><span></span><span>
</span><a name="line-104"></a><span class="hs-comment">-- merge two ordered lists</span><span>
</span><a name="line-105"></a><a name="merge"><a href="Math.Algebra.Group.StringRewriting.html#merge"><span class="hs-identifier">merge</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679093478"><a href="#local-6989586621679093478"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679093479"><a href="#local-6989586621679093479"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679093480"><a href="#local-6989586621679093480"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679093481"><a href="#local-6989586621679093481"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span></span><span>
</span><a name="line-106"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">compare</span><span> </span><a href="#local-6989586621679093478"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679093480"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-keyword">of</span><span></span><span>
</span><a name="line-107"></a><span>    </span><span class="hs-identifier hs-var">LT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679093478"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#merge"><span class="hs-identifier hs-var">merge</span></a><span> </span><a href="#local-6989586621679093479"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093480"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679093481"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span></span><span>
</span><a name="line-108"></a><span>    </span><span class="hs-identifier hs-var">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679093480"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#merge"><span class="hs-identifier hs-var">merge</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093478"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679093479"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679093481"><span class="hs-identifier hs-var">ys</span></a><span></span><span>
</span><a name="line-109"></a><span>    </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-comment">-- shouldn't happen in our case</span><span>
</span><a name="line-110"></a><span class="hs-identifier">merge</span><span> </span><a name="local-6989586621679093482"><a href="#local-6989586621679093482"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-6989586621679093483"><a href="#local-6989586621679093483"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679093482"><span class="hs-identifier hs-var">xs</span></a><span class="hs-operator hs-var">++</span><a href="#local-6989586621679093483"><span class="hs-identifier hs-var">ys</span></a><span></span><span>
</span><a name="line-111"></a><span></span><span>
</span><a name="line-112"></a><span class="hs-comment">-- Another optimisation - at the stage where we remove some rules, we remove corresponding pairs too</span><span>
</span><a name="line-113"></a><span class="hs-comment">-- Seems to perform about 25% faster on large problems (eg Coxeter groups A4-12, B4-12)</span><span>
</span><a name="line-114"></a><a name="knuthBendix3"><a href="Math.Algebra.Group.StringRewriting.html#knuthBendix3"><span class="hs-identifier">knuthBendix3</span></a></a><span> </span><a name="local-6989586621679093484"><a href="#local-6989586621679093484"><span class="hs-identifier">rules</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679093487"><span class="hs-identifier hs-var">knuthBendix'</span></a><span> </span><a href="#local-6989586621679093485"><span class="hs-identifier hs-var">rules'</span></a><span> </span><a href="#local-6989586621679093486"><span class="hs-identifier hs-var">pairs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679093485"><span class="hs-identifier hs-var">rules'</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span></span><span>
</span><a name="line-115"></a><span>    </span><a name="local-6989586621679093485"><a href="#local-6989586621679093485"><span class="hs-identifier">rules'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">sort</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679093492"><a href="#local-6989586621679093492"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679093493"><a href="#local-6989586621679093493"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093494"><a href="#local-6989586621679093494"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679093493"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621679093492"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span class="hs-special">(</span><a href="#local-6989586621679093493"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621679093494"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679093484"><span class="hs-identifier hs-var">rules</span></a><span></span><span>
</span><a name="line-116"></a><span>    </span><a name="local-6989586621679093486"><a href="#local-6989586621679093486"><span class="hs-identifier">pairs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">sort</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679093491"><span class="hs-identifier hs-var">sizedPair</span></a><span> </span><a href="#local-6989586621679093495"><span class="hs-identifier hs-var">ri</span></a><span> </span><a href="#local-6989586621679093496"><span class="hs-identifier hs-var">rj</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679093495"><a href="#local-6989586621679093495"><span class="hs-identifier">ri</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679093485"><span class="hs-identifier hs-var">rules'</span></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679093496"><a href="#local-6989586621679093496"><span class="hs-identifier">rj</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679093485"><span class="hs-identifier hs-var">rules'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679093495"><span class="hs-identifier hs-var">ri</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679093496"><span class="hs-identifier hs-var">rj</span></a><span class="hs-special">]</span><span></span><span>
</span><a name="line-117"></a><span>    </span><a name="local-6989586621679093487"><a href="#local-6989586621679093487"><span class="hs-identifier">knuthBendix'</span></a></a><span> </span><a name="local-6989586621679093497"><a href="#local-6989586621679093497"><span class="hs-identifier">rules</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679093498"><a href="#local-6989586621679093498"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679093499"><a href="#local-6989586621679093499"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093500"><a href="#local-6989586621679093500"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093501"><a href="#local-6989586621679093501"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679093501"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679093497"><span class="hs-identifier hs-var">rules</span></a><span></span><span>
</span><a name="line-118"></a><span>    </span><span class="hs-identifier">knuthBendix'</span><span> </span><a name="local-6989586621679093502"><a href="#local-6989586621679093502"><span class="hs-identifier">rules</span></a></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679093503"><a href="#local-6989586621679093503"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><span class="hs-special">(</span><a name="local-6989586621679093504"><a href="#local-6989586621679093504"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093505"><a href="#local-6989586621679093505"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679093506"><a href="#local-6989586621679093506"><span class="hs-identifier">li</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093507"><a href="#local-6989586621679093507"><span class="hs-identifier">ri</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><a name="local-6989586621679093508"><a href="#local-6989586621679093508"><span class="hs-identifier">lj</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093509"><a href="#local-6989586621679093509"><span class="hs-identifier">rj</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679093510"><a href="#local-6989586621679093510"><span class="hs-identifier">ps</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679093511"><a href="#local-6989586621679093511"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span></span><span>
</span><a name="line-119"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#findOverlap"><span class="hs-identifier hs-var">findOverlap</span></a><span> </span><a href="#local-6989586621679093506"><span class="hs-identifier hs-var">li</span></a><span> </span><a href="#local-6989586621679093508"><span class="hs-identifier hs-var">lj</span></a><span> </span><span class="hs-keyword">of</span><span></span><span>
</span><a name="line-120"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679093487"><span class="hs-identifier hs-var">knuthBendix'</span></a><span> </span><a href="#local-6989586621679093502"><span class="hs-identifier hs-var">rules</span></a><span> </span><a href="#local-6989586621679093510"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="#local-6989586621679093511"><span class="hs-identifier hs-var">k</span></a><span></span><span>
</span><a name="line-121"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679093512"><a href="#local-6989586621679093512"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093513"><a href="#local-6989586621679093513"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093514"><a href="#local-6989586621679093514"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679093488"><span class="hs-identifier hs-var">ordpair</span></a><span> </span><a href="#local-6989586621679093511"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><a href="Math.Algebra.Group.StringRewriting.html#rewrite"><span class="hs-identifier hs-var">rewrite</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679093490"><span class="hs-identifier hs-var">third</span></a><span> </span><a href="#local-6989586621679093502"><span class="hs-identifier hs-var">rules</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093507"><span class="hs-identifier hs-var">ri</span></a><span class="hs-operator hs-var">++</span><a href="#local-6989586621679093514"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Math.Algebra.Group.StringRewriting.html#rewrite"><span class="hs-identifier hs-var">rewrite</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679093490"><span class="hs-identifier hs-var">third</span></a><span> </span><a href="#local-6989586621679093502"><span class="hs-identifier hs-var">rules</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093512"><span class="hs-identifier hs-var">a</span></a><span class="hs-operator hs-var">++</span><a href="#local-6989586621679093509"><span class="hs-identifier hs-var">rj</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span></span><span>
</span><a name="line-122"></a><span>                        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679093487"><span class="hs-identifier hs-var">knuthBendix'</span></a><span> </span><a href="#local-6989586621679093502"><span class="hs-identifier hs-var">rules</span></a><span> </span><a href="#local-6989586621679093510"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="#local-6989586621679093511"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-comment">-- they both reduce to the same thing</span><span>
</span><a name="line-123"></a><span>                        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679093515"><a href="#local-6989586621679093515"><span class="hs-identifier">rule'</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-special">(</span><a name="local-6989586621679093516"><a href="#local-6989586621679093516"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093517"><a href="#local-6989586621679093517"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span></span><span>
</span><a name="line-124"></a><span>                            </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679093518"><a href="#local-6989586621679093518"><span class="hs-identifier">outrules</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093519"><a href="#local-6989586621679093519"><span class="hs-identifier">inrules</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">partition</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679093523"><a href="#local-6989586621679093523"><span class="hs-identifier">s'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093524"><a href="#local-6989586621679093524"><span class="hs-identifier">i'</span></a></a><span class="hs-special">,</span><span class="hs-special">(</span><a name="local-6989586621679093525"><a href="#local-6989586621679093525"><span class="hs-identifier">l'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093526"><a href="#local-6989586621679093526"><span class="hs-identifier">r'</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">isInfixOf</span><span> </span><a href="#local-6989586621679093516"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679093525"><span class="hs-identifier hs-var">l'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679093502"><span class="hs-identifier hs-var">rules</span></a><span></span><span>
</span><a name="line-125"></a><span>                                </span><a name="local-6989586621679093520"><a href="#local-6989586621679093520"><span class="hs-identifier">removedIndices</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679093489"><span class="hs-identifier hs-var">second</span></a><span> </span><a href="#local-6989586621679093518"><span class="hs-identifier hs-var">outrules</span></a><span></span><span>
</span><a name="line-126"></a><span>                                </span><a name="local-6989586621679093521"><a href="#local-6989586621679093521"><span class="hs-identifier">ps'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679093527"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679093527"><a href="#local-6989586621679093527"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679093528"><a href="#local-6989586621679093528"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><span class="hs-special">(</span><a name="local-6989586621679093529"><a href="#local-6989586621679093529"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093530"><a href="#local-6989586621679093530"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><a name="local-6989586621679093531"><a href="#local-6989586621679093531"><span class="hs-identifier">ri</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093532"><a href="#local-6989586621679093532"><span class="hs-identifier">rj</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679093510"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679093529"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679093520"><span class="hs-identifier hs-var">removedIndices</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679093530"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679093520"><span class="hs-identifier hs-var">removedIndices</span></a><span class="hs-special">]</span><span></span><span>
</span><a name="line-127"></a><span>                                </span><a name="local-6989586621679093522"><a href="#local-6989586621679093522"><span class="hs-identifier">ps''</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#merge"><span class="hs-identifier hs-var">merge</span></a><span> </span><a href="#local-6989586621679093521"><span class="hs-identifier hs-var">ps'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#merge"><span class="hs-identifier hs-var">merge</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679093491"><span class="hs-identifier hs-var">sizedPair</span></a><span> </span><a href="#local-6989586621679093515"><span class="hs-identifier hs-var">rule'</span></a><span> </span><a href="#local-6989586621679093533"><span class="hs-identifier hs-var">rule</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679093533"><a href="#local-6989586621679093533"><span class="hs-identifier">rule</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679093519"><span class="hs-identifier hs-var">inrules</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679093491"><span class="hs-identifier hs-var">sizedPair</span></a><span> </span><a href="#local-6989586621679093534"><span class="hs-identifier hs-var">rule</span></a><span> </span><a href="#local-6989586621679093515"><span class="hs-identifier hs-var">rule'</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679093534"><a href="#local-6989586621679093534"><span class="hs-identifier">rule</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679093519"><span class="hs-identifier hs-var">inrules</span></a><span class="hs-special">]</span><span></span><span>
</span><a name="line-128"></a><span>                            </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679093487"><span class="hs-identifier hs-var">knuthBendix'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span><span> </span><a href="#local-6989586621679093515"><span class="hs-identifier hs-var">rule'</span></a><span> </span><a href="#local-6989586621679093519"><span class="hs-identifier hs-var">inrules</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679093522"><span class="hs-identifier hs-var">ps''</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093511"><span class="hs-identifier hs-var">k</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span></span><span>
</span><a name="line-129"></a><span>    </span><a name="local-6989586621679093488"><a href="#local-6989586621679093488"><span class="hs-identifier">ordpair</span></a></a><span> </span><a name="local-6989586621679093535"><a href="#local-6989586621679093535"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679093536"><a href="#local-6989586621679093536"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679093537"><a href="#local-6989586621679093537"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span></span><span>
</span><a name="line-130"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679093538"><a href="#local-6989586621679093538"><span class="hs-identifier">lx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679093536"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">;</span><span> </span><a name="local-6989586621679093539"><a href="#local-6989586621679093539"><span class="hs-identifier">ly</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679093537"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-keyword">in</span><span></span><span>
</span><a name="line-131"></a><span>            </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">compare</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093538"><span class="hs-identifier hs-var">lx</span></a><span class="hs-special">,</span><a href="#local-6989586621679093536"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093539"><span class="hs-identifier hs-var">ly</span></a><span class="hs-special">,</span><a href="#local-6989586621679093537"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span></span><span>
</span><a name="line-132"></a><span>            </span><span class="hs-identifier hs-var">LT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093539"><span class="hs-identifier hs-var">ly</span></a><span class="hs-special">,</span><a href="#local-6989586621679093535"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span class="hs-special">(</span><a href="#local-6989586621679093537"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><a href="#local-6989586621679093536"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093538"><span class="hs-identifier hs-var">lx</span></a><span class="hs-special">,</span><a href="#local-6989586621679093535"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span class="hs-special">(</span><a href="#local-6989586621679093536"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679093537"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span></span><span>
</span><a name="line-133"></a><span>    </span><a name="local-6989586621679093489"><a href="#local-6989586621679093489"><span class="hs-identifier">second</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679093540"><a href="#local-6989586621679093540"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093541"><a href="#local-6989586621679093541"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093542"><a href="#local-6989586621679093542"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679093541"><span class="hs-identifier hs-var">i</span></a><span></span><span>
</span><a name="line-134"></a><span>    </span><a name="local-6989586621679093490"><a href="#local-6989586621679093490"><span class="hs-identifier">third</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679093543"><a href="#local-6989586621679093543"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093544"><a href="#local-6989586621679093544"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093545"><a href="#local-6989586621679093545"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679093545"><span class="hs-identifier hs-var">r</span></a><span></span><span>
</span><a name="line-135"></a><span>    </span><a name="local-6989586621679093491"><a href="#local-6989586621679093491"><span class="hs-identifier">sizedPair</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679093546"><a href="#local-6989586621679093546"><span class="hs-identifier">si</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093547"><a href="#local-6989586621679093547"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093548"><a href="#local-6989586621679093548"><span class="hs-identifier">ri</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679093549"><a href="#local-6989586621679093549"><span class="hs-identifier">sj</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093550"><a href="#local-6989586621679093550"><span class="hs-identifier">j</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093551"><a href="#local-6989586621679093551"><span class="hs-identifier">rj</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093546"><span class="hs-identifier hs-var">si</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679093549"><span class="hs-identifier hs-var">sj</span></a><span class="hs-special">,</span><span class="hs-special">(</span><a href="#local-6989586621679093547"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679093550"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><a href="#local-6989586621679093548"><span class="hs-identifier hs-var">ri</span></a><span class="hs-special">,</span><a href="#local-6989586621679093551"><span class="hs-identifier hs-var">rj</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span></span><span>
</span><a name="line-136"></a><span></span><span>
</span><a name="line-137"></a><span></span><span>
</span><a name="line-138"></a><span class="hs-comment">-- |Implementation of the Knuth-Bendix algorithm. Given a list of relations, return a confluent rewrite system.</span><span>
</span><a name="line-139"></a><span class="hs-comment">-- The algorithm is not guaranteed to terminate.</span><span>
</span><a name="line-140"></a><span class="hs-identifier">knuthBendix</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679093372"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621679093372"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679093372"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621679093372"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679093372"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span></span><span>
</span><a name="line-141"></a><a name="knuthBendix"><a href="Math.Algebra.Group.StringRewriting.html#knuthBendix"><span class="hs-identifier">knuthBendix</span></a></a><span> </span><a name="local-6989586621679093552"><a href="#local-6989586621679093552"><span class="hs-identifier">relations</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#knuthBendix3"><span class="hs-identifier hs-var">knuthBendix3</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093554"><span class="hs-identifier hs-var">reduce</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679093553"><span class="hs-identifier hs-var">rules</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span></span><span>
</span><a name="line-142"></a><span>    </span><a name="local-6989586621679093553"><a href="#local-6989586621679093553"><span class="hs-identifier">rules</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><span class="hs-special">[</span><a href="Math.Algebra.Group.StringRewriting.html#ordpair"><span class="hs-identifier hs-var">ordpair</span></a><span> </span><a href="#local-6989586621679093556"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679093557"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679093556"><a href="#local-6989586621679093556"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093557"><a href="#local-6989586621679093557"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679093552"><span class="hs-identifier hs-var">relations</span></a><span class="hs-special">]</span><span></span><span>
</span><a name="line-143"></a><span>    </span><a name="local-6989586621679093554"><a href="#local-6989586621679093554"><span class="hs-identifier">reduce</span></a></a><span> </span><a name="local-6989586621679093558"><a href="#local-6989586621679093558"><span class="hs-identifier">ls</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679093559"><a href="#local-6989586621679093559"><span class="hs-identifier">r</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679093560"><a href="#local-6989586621679093560"><span class="hs-identifier">rs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679093554"><span class="hs-identifier hs-var">reduce</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093559"><span class="hs-identifier hs-var">r</span></a><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679093555"><span class="hs-identifier hs-var">reduce'</span></a><span> </span><a href="#local-6989586621679093559"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679093558"><span class="hs-identifier hs-var">ls</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093555"><span class="hs-identifier hs-var">reduce'</span></a><span> </span><a href="#local-6989586621679093559"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679093560"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span></span><span>
</span><a name="line-144"></a><span>    </span><span class="hs-identifier">reduce</span><span> </span><a name="local-6989586621679093561"><a href="#local-6989586621679093561"><span class="hs-identifier">ls</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679093561"><span class="hs-identifier hs-var">ls</span></a><span></span><span>
</span><a name="line-145"></a><span>    </span><a name="local-6989586621679093555"><a href="#local-6989586621679093555"><span class="hs-identifier">reduce'</span></a></a><span> </span><a name="local-6989586621679093562"><a href="#local-6989586621679093562"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679093563"><a href="#local-6989586621679093563"><span class="hs-identifier">rules</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><span class="hs-special">[</span><a href="Math.Algebra.Group.StringRewriting.html#ordpair"><span class="hs-identifier hs-var">ordpair</span></a><span> </span><span class="hs-special">(</span><a href="Math.Algebra.Group.StringRewriting.html#rewrite"><span class="hs-identifier hs-var">rewrite</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679093562"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679093564"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Math.Algebra.Group.StringRewriting.html#rewrite"><span class="hs-identifier hs-var">rewrite</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679093562"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679093565"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679093564"><a href="#local-6989586621679093564"><span class="hs-identifier">lhs</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093565"><a href="#local-6989586621679093565"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679093563"><span class="hs-identifier hs-var">rules</span></a><span class="hs-special">]</span><span></span><span>
</span><a name="line-146"></a><span></span><span>
</span><a name="line-147"></a><span></span><span>
</span><a name="line-148"></a><span class="hs-comment">-- |Given generators and a confluent rewrite system, return (normal forms of) all elements</span><span>
</span><a name="line-149"></a><span class="hs-identifier">nfs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679093371"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621679093371"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621679093371"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679093371"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679093371"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span></span><span>
</span><a name="line-150"></a><a name="nfs"><a href="Math.Algebra.Group.StringRewriting.html#nfs"><span class="hs-identifier">nfs</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679093566"><a href="#local-6989586621679093566"><span class="hs-identifier">gs</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093567"><a href="#local-6989586621679093567"><span class="hs-identifier">rs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679093568"><span class="hs-identifier hs-var">nfs'</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span></span><span>
</span><a name="line-151"></a><span>    </span><a name="local-6989586621679093568"><a href="#local-6989586621679093568"><span class="hs-identifier">nfs'</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- we have run out of words - this monoid is finite</span><span>
</span><a name="line-152"></a><span>    </span><span class="hs-identifier">nfs'</span><span> </span><a name="local-6989586621679093569"><a href="#local-6989586621679093569"><span class="hs-identifier">ws</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679093570"><a href="#local-6989586621679093570"><span class="hs-identifier">ws'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679093571"><span class="hs-identifier hs-var">g</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679093572"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679093571"><a href="#local-6989586621679093571"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679093566"><span class="hs-identifier hs-var">gs</span></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679093572"><a href="#local-6989586621679093572"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679093569"><span class="hs-identifier hs-var">ws</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093571"><span class="hs-identifier hs-var">g</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679093572"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679093567"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span></span><span>
</span><a name="line-153"></a><span>              </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679093569"><span class="hs-identifier hs-var">ws</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679093568"><span class="hs-identifier hs-var">nfs'</span></a><span> </span><a href="#local-6989586621679093570"><span class="hs-identifier hs-var">ws'</span></a><span></span><span>
</span><a name="line-154"></a><span></span><span>
</span><a name="line-155"></a><span class="hs-comment">-- |Given generators and relations, return (normal forms of) all elements</span><span>
</span><a name="line-156"></a><span class="hs-identifier">elts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679093370"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621679093370"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621679093370"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679093370"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679093370"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span></span><span>
</span><a name="line-157"></a><a name="elts"><a href="Math.Algebra.Group.StringRewriting.html#elts"><span class="hs-identifier">elts</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679093573"><a href="#local-6989586621679093573"><span class="hs-identifier">gs</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093574"><a href="#local-6989586621679093574"><span class="hs-identifier">rs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#nfs"><span class="hs-identifier hs-var">nfs</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093573"><span class="hs-identifier hs-var">gs</span></a><span class="hs-special">,</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#knuthBendix"><span class="hs-identifier hs-var">knuthBendix</span></a><span> </span><a href="#local-6989586621679093574"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span></span><span>
</span><a name="line-158"></a><span></span><span>
</span><a name="line-159"></a><span></span><span>
</span><a name="line-160"></a><span class="hs-comment">-- PRESENTATIONS FOR SOME STANDARD GROUPS</span><span>
</span><a name="line-161"></a><span class="hs-comment">-- Would like to add a few more to this list</span><span>
</span><a name="line-162"></a><span></span><span>
</span><a name="line-163"></a><span class="hs-keyword">newtype</span><span> </span><a name="SGen"><a href="Math.Algebra.Group.StringRewriting.html#SGen"><span class="hs-identifier">SGen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="S"><a href="Math.Algebra.Group.StringRewriting.html#S"><span class="hs-identifier">S</span></a></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span></span><span>
</span><a name="line-164"></a><span></span><span>
</span><a name="line-165"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#SGen"><span class="hs-identifier hs-type">SGen</span></a><span> </span><span class="hs-keyword">where</span><span></span><span>
</span><a name="line-166"></a><span>    </span><a name="local-8214565720323790731"><span class="hs-identifier">show</span></a><span> </span><span class="hs-special">(</span><a href="Math.Algebra.Group.StringRewriting.html#S"><span class="hs-identifier hs-var">S</span></a><span> </span><a name="local-6989586621679093606"><a href="#local-6989586621679093606"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;s&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679093606"><span class="hs-identifier hs-var">i</span></a><span></span><span>
</span><a name="line-167"></a><span></span><span>
</span><a name="line-168"></a><a name="s_"><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier">s_</span></a></a><span> </span><a name="local-6989586621679093575"><a href="#local-6989586621679093575"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#S"><span class="hs-identifier hs-var">S</span></a><span> </span><a href="#local-6989586621679093575"><span class="hs-identifier hs-var">i</span></a><span></span><span>
</span><a name="line-169"></a><a name="s1"><a href="Math.Algebra.Group.StringRewriting.html#s1"><span class="hs-identifier">s1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><span class="hs-number">1</span><span></span><span>
</span><a name="line-170"></a><a name="s2"><a href="Math.Algebra.Group.StringRewriting.html#s2"><span class="hs-identifier">s2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><span class="hs-number">2</span><span></span><span>
</span><a name="line-171"></a><a name="s3"><a href="Math.Algebra.Group.StringRewriting.html#s3"><span class="hs-identifier">s3</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><span class="hs-number">3</span><span></span><span>
</span><a name="line-172"></a><span></span><span>
</span><a name="line-173"></a><span class="hs-comment">-- D L Johnson, Presentations of Groups, p62</span><span>
</span><a name="line-174"></a><span></span><span>
</span><a name="line-175"></a><span class="hs-comment">-- symmetric group, generated by adjacent transpositions</span><span>
</span><a name="line-176"></a><a name="_S"><a href="Math.Algebra.Group.StringRewriting.html#_S"><span class="hs-identifier">_S</span></a></a><span> </span><a name="local-6989586621679093576"><a href="#local-6989586621679093576"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093577"><span class="hs-identifier hs-var">gs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679093578"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679093579"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679093580"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span></span><span>
</span><a name="line-177"></a><span>    </span><a name="local-6989586621679093577"><a href="#local-6989586621679093577"><span class="hs-identifier">gs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><a href="#local-6989586621679093576"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">]</span><span></span><span>
</span><a name="line-178"></a><span>    </span><a name="local-6989586621679093578"><a href="#local-6989586621679093578"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><a href="#local-6989586621679093581"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><a href="#local-6989586621679093581"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679093581"><a href="#local-6989586621679093581"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><a href="#local-6989586621679093576"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">]</span><span class="hs-special">]</span><span></span><span>
</span><a name="line-179"></a><span>    </span><a name="local-6989586621679093579"><a href="#local-6989586621679093579"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><span class="hs-number">3</span><span> </span><span class="hs-special">[</span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><a href="#local-6989586621679093582"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093582"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679093582"><a href="#local-6989586621679093582"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><a href="#local-6989586621679093576"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">2</span><span class="hs-special">]</span><span class="hs-special">]</span><span></span><span>
</span><a name="line-180"></a><span>    </span><a name="local-6989586621679093580"><a href="#local-6989586621679093580"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><a href="#local-6989586621679093583"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><a href="#local-6989586621679093584"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">,</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><a href="#local-6989586621679093583"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><a href="#local-6989586621679093584"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679093583"><a href="#local-6989586621679093583"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><a href="#local-6989586621679093576"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679093584"><a href="#local-6989586621679093584"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679093583"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">2</span><span class="hs-glyph">..</span><a href="#local-6989586621679093576"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">]</span><span class="hs-special">]</span><span></span><span>
</span><a name="line-181"></a><span></span><span>
</span><a name="line-182"></a><span class="hs-comment">-- braid presentation for Sn</span><span>
</span><a name="line-183"></a><a name="_S%27"><a href="Math.Algebra.Group.StringRewriting.html#_S%27"><span class="hs-identifier">_S'</span></a></a><span> </span><a name="local-6989586621679093585"><a href="#local-6989586621679093585"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093586"><span class="hs-identifier hs-var">gs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679093587"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679093588"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679093589"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span></span><span>
</span><a name="line-184"></a><span>    </span><a name="local-6989586621679093586"><a href="#local-6989586621679093586"><span class="hs-identifier">gs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><a href="#local-6989586621679093585"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">]</span><span></span><span>
</span><a name="line-185"></a><span>    </span><a name="local-6989586621679093587"><a href="#local-6989586621679093587"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><a href="#local-6989586621679093590"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><a href="#local-6989586621679093590"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679093590"><a href="#local-6989586621679093590"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><a href="#local-6989586621679093585"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">]</span><span class="hs-special">]</span><span></span><span>
</span><a name="line-186"></a><span>    </span><a name="local-6989586621679093588"><a href="#local-6989586621679093588"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093591"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><a href="#local-6989586621679093591"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093591"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><a href="#local-6989586621679093591"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093591"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><a href="#local-6989586621679093591"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679093591"><a href="#local-6989586621679093591"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><a href="#local-6989586621679093585"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">2</span><span class="hs-special">]</span><span class="hs-special">]</span><span></span><span>
</span><a name="line-187"></a><span>    </span><a name="local-6989586621679093589"><a href="#local-6989586621679093589"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><a href="#local-6989586621679093592"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><a href="#local-6989586621679093593"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">,</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><a href="#local-6989586621679093592"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><a href="Math.Algebra.Group.StringRewriting.html#s_"><span class="hs-identifier hs-var">s_</span></a><span> </span><a href="#local-6989586621679093593"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679093592"><a href="#local-6989586621679093592"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><a href="#local-6989586621679093585"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679093593"><a href="#local-6989586621679093593"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679093592"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">2</span><span class="hs-glyph">..</span><a href="#local-6989586621679093585"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">]</span><span class="hs-special">]</span><span></span><span>
</span><a name="line-188"></a><span></span><span>
</span><a name="line-189"></a><span class="hs-comment">-- http://en.wikipedia.org/wiki/Triangle_group</span><span>
</span><a name="line-190"></a><span class="hs-comment">-- triangle groups - Johnson p127ff</span><span>
</span><a name="line-191"></a><a name="tri"><a href="Math.Algebra.Group.StringRewriting.html#tri"><span class="hs-identifier">tri</span></a></a><span> </span><a name="local-6989586621679093594"><a href="#local-6989586621679093594"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679093595"><a href="#local-6989586621679093595"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679093596"><a href="#local-6989586621679093596"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;abc&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-string">&quot;aa&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-string">&quot;bb&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-string">&quot;cc&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-string">&quot;ab&quot;</span><span> </span><a href="#local-6989586621679093597"><span class="hs-operator hs-var">^</span></a><span> </span><a href="#local-6989586621679093594"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-string">&quot;bc&quot;</span><span> </span><a href="#local-6989586621679093597"><span class="hs-operator hs-var">^</span></a><span> </span><a href="#local-6989586621679093596"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-string">&quot;ca&quot;</span><span> </span><a href="#local-6989586621679093597"><span class="hs-operator hs-var">^</span></a><span> </span><a href="#local-6989586621679093595"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">,</span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span></span><span>
</span><a name="line-192"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679093598"><a href="#local-6989586621679093598"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-6989586621679093597"><a href="#local-6989586621679093597"><span class="hs-operator">^</span></a></a><span> </span><a name="local-6989586621679093599"><a href="#local-6989586621679093599"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621679093599"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679093598"><span class="hs-identifier hs-var">xs</span></a><span></span><span>
</span><a name="line-193"></a><span></span><span>
</span><a name="line-194"></a><span class="hs-comment">-- von Dyck groups - Johnson p121ff</span><span>
</span><a name="line-195"></a><span class="hs-comment">-- The subgroup of index 2 in the triangle group consisting of elts that preserve the orientation of the triangle</span><span>
</span><a name="line-196"></a><a name="_D"><a href="Math.Algebra.Group.StringRewriting.html#_D"><span class="hs-identifier">_D</span></a></a><span> </span><a name="local-6989586621679093600"><a href="#local-6989586621679093600"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679093601"><a href="#local-6989586621679093601"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679093602"><a href="#local-6989586621679093602"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;xy&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-string">&quot;x&quot;</span><span> </span><a href="#local-6989586621679093603"><span class="hs-operator hs-var">^</span></a><span> </span><a href="#local-6989586621679093600"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;y&quot;</span><span> </span><a href="#local-6989586621679093603"><span class="hs-operator hs-var">^</span></a><span> </span><a href="#local-6989586621679093601"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">,</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;xy&quot;</span><span> </span><a href="#local-6989586621679093603"><span class="hs-operator hs-var">^</span></a><span> </span><a href="#local-6989586621679093602"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span></span><span>
</span><a name="line-197"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679093604"><a href="#local-6989586621679093604"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-6989586621679093603"><a href="#local-6989586621679093603"><span class="hs-operator">^</span></a></a><span> </span><a name="local-6989586621679093605"><a href="#local-6989586621679093605"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621679093605"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679093604"><span class="hs-identifier hs-var">xs</span></a><span></span><span>
</span><a name="line-198"></a><span></span><span>
</span><a name="line-199"></a><span class="hs-comment">-- Degenerate cases: n == 1 =&gt; cyclic group</span><span>
</span><a name="line-200"></a><span class="hs-comment">-- l,2,2, l&gt;=2 -&gt; n-gon bipyramid - dihedral group</span><span>
</span><a name="line-201"></a><span class="hs-comment">-- Spherical case: 1/l+1/m+1/n &gt; 1</span><span>
</span><a name="line-202"></a><span class="hs-comment">-- 3,3,2 -&gt; tetrahedron; 4,3,2 -&gt; octahedron; 5,3,2 -&gt; icosahedron</span><span>
</span><a name="line-203"></a><span class="hs-comment">-- Euclidean case: 1/l+1/m+1/n == 1</span><span>
</span><a name="line-204"></a><span class="hs-comment">-- 3,3,3  4,4,2  6,3,2 </span><span>
</span><a name="line-205"></a><span class="hs-comment">-- Hyperbolic case: 1/l+1/m+1/n &lt; 1</span><span>
</span><a name="line-206"></a><span></span><span>
</span><a name="line-207"></a><span></span><span>
</span><a name="line-208"></a></pre></body></html>